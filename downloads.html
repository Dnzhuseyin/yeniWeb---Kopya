<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaynaklar - CyberEdu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e40af',
                        secondary: '#dc2626',
                        accent: '#059669',
                        cyber: '#6366f1',
                        dark: '#0f172a'
                    }
                },
                fontFamily: {
                    sans: ['Inter', 'sans-serif'],
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="js/firebase-production.js"></script>
    <script src="js/user-utils.js"></script>
</head>
<body class="bg-gray-50 min-h-screen flex">
    <!-- Sidebar -->
    <aside class="bg-dark text-white w-64 min-h-screen fixed left-0 top-0 z-20 hidden md:block">
        <div class="p-4">
            <a href="student-dashboard.html" class="font-bold text-xl text-cyber block mb-8 flex items-center">
                <i class="fas fa-shield-alt text-2xl mr-3"></i>
                CyberEdu
            </a>
            
            <div class="mb-8">
                <div class="flex items-center mb-4">
                    <div>
                        <p class="font-medium" id="user-name"></p>
                        <p class="text-sm text-gray-400" id="user-email"></p>
                    </div>
                </div>
            </div>
            
            <nav class="space-y-1">
                <a href="student-dashboard.html" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-800">
                    <i class="fas fa-tachometer-alt mr-3"></i>
                    <span>Genel Bakış</span>
                </a>
                <a href="courses.html" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-800">
                    <i class="fas fa-graduation-cap mr-3"></i>
                    <span>Eğitim Modülleri</span>
                </a>
                <a href="progress.html" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-800">
                    <i class="fas fa-chart-line mr-3"></i>
                    <span>İlerlemem</span>
                </a>
                <a href="my-notes.html" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-800">
                    <i class="fas fa-sticky-note mr-3"></i>
                    <span>Notlarım</span>
                </a>
                <a href="downloads.html" class="flex items-center px-4 py-3 rounded-lg bg-slate-800">
                    <i class="fas fa-download mr-3 text-cyber"></i>
                    <span>Kaynaklar</span>
                </a>
                <a href="account.html" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-800">
                    <i class="fas fa-user-cog mr-3"></i>
                    <span>Profil Ayarları</span>
                </a>
            </nav>

            <div class="absolute bottom-0 left-0 w-full p-4 border-t border-slate-800">
                <a href="index.html" class="flex items-center text-gray-400 hover:text-white">
                    <i class="fas fa-sign-out-alt mr-3"></i>
                    <span>Çıkış Yap</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- Mobile menu -->
    <div class="md:hidden fixed top-0 left-0 right-0 z-20 bg-slate-900 text-white p-4 flex justify-between items-center">
        <a href="student-dashboard.html" class="font-bold text-xl text-primary">Çevik Liderlik</a>
        <button class="text-white" id="mobile-menu-button">
            <i class="fas fa-bars text-xl"></i>
        </button>
    </div>

    <!-- Main content -->
    <main class="md:ml-64 p-4 md:p-8 w-full min-h-screen">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <header class="mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900 mb-2 flex items-center">
                            <i class="fas fa-download text-cyber mr-3"></i>
                            Kaynaklar
                        </h1>
                        <p class="text-gray-600">Siber güvenlik eğitimi için gerekli tüm kaynaklara buradan ulaşabilirsiniz</p>
                    </div>
                    <div class="bg-white rounded-lg px-4 py-2 shadow-sm border border-gray-100">
                        <span class="text-sm text-gray-600">Toplam Kaynak:</span>
                        <span class="font-bold text-cyber ml-1" id="total-resources">43</span>
                    </div>
                </div>
            </header>
            
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-sm font-medium text-gray-600">PDF Dokümanlar</h3>
                        <div class="h-10 w-10 bg-secondary/10 text-secondary rounded-lg flex items-center justify-center">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                    </div>
                    <p class="text-2xl font-bold text-gray-900">24</p>
                    <p class="text-xs text-gray-500 mt-1">eğitim materyali</p>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-sm font-medium text-gray-600">Video Kaynaklar</h3>
                        <div class="h-10 w-10 bg-cyber/10 text-cyber rounded-lg flex items-center justify-center">
                            <i class="fas fa-video"></i>
                </div>
            </div>
                    <p class="text-2xl font-bold text-gray-900">12</p>
                    <p class="text-xs text-gray-500 mt-1">ek video</p>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-sm font-medium text-gray-600">Araçlar & Yazılım</h3>
                        <div class="h-10 w-10 bg-primary/10 text-primary rounded-lg flex items-center justify-center">
                            <i class="fas fa-tools"></i>
                        </div>
                    </div>
                    <p class="text-2xl font-bold text-gray-900">7</p>
                    <p class="text-xs text-gray-500 mt-1">güvenlik aracı</p>
                        </div>
                
                <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-sm font-medium text-gray-600">Toplam İndirme</h3>
                        <div class="h-10 w-10 bg-accent/10 text-accent rounded-lg flex items-center justify-center">
                                    <i class="fas fa-download"></i>
                        </div>
                            </div>
                    <p class="text-2xl font-bold text-gray-900">1,247</p>
                    <p class="text-xs text-gray-500 mt-1">bu ay</p>
                        </div>
                    </div>
                    
            <!-- Filter and Search -->
            <div class="bg-white rounded-xl shadow-sm p-6 mb-8 border border-gray-100">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Arama</label>
                        <input type="text" placeholder="Kaynak ara..." 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyber focus:border-transparent"
                               id="search-resources">
                            </div>
                            <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Kategori</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyber focus:border-transparent"
                                id="filter-category">
                            <option value="">Tüm Kategoriler</option>
                            <option value="pdf">PDF Dokümanlar</option>
                            <option value="video">Video Kaynaklar</option>
                            <option value="tools">Araçlar & Yazılım</option>
                            <option value="template">Şablonlar</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Modül</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyber focus:border-transparent"
                                id="filter-module">
                            <option value="">Tüm Modüller</option>
                        </select>
                            </div>
                            <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sıralama</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyber focus:border-transparent"
                                id="sort-resources">
                            <option value="newest">En Yeni</option>
                            <option value="popular">En Popüler</option>
                            <option value="name">İsim</option>
                            <option value="size">Boyut</option>
                        </select>
                            </div>
                        </div>
                    </div>
                    
            <!-- Featured Resources -->
            <div class="bg-white rounded-xl shadow-sm p-6 mb-8 border border-gray-100">
                <h2 class="text-xl font-semibold mb-6 flex items-center">
                    <i class="fas fa-star text-cyber mr-2"></i>
                    Öne Çıkan Kaynaklar
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="featured-resources">
                    <!-- Featured resources will be loaded here -->
                </div>
            </div>
            
            <!-- Resources Grid -->
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                <h2 class="text-xl font-semibold mb-6 flex items-center">
                    <i class="fas fa-folder-open text-primary mr-2"></i>
                    Tüm Kaynaklar
                </h2>
                
                <div class="grid grid-cols-1 gap-4" id="resources-container">
                    <!-- Resources will be loaded here -->
                </div>
            </div>
        </div>
    </main>

    <script src="js/main.js"></script>
    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize user info
            const isLoggedIn = await UserUtils.initializeUserInfo();
            if (!isLoggedIn) return;
            
            setupEventListeners();
            await loadDownloads(); // Load resources on page load
        });

        // Setup event listeners
        function setupEventListeners() {
            // Mobile menu functionality
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', function() {
                    // Add mobile menu toggle logic here if needed
                });
            }

            // Logout functionality
            document.querySelectorAll('a[href="index.html"]').forEach(function(link) {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    localStorage.removeItem('isLoggedIn');
                    localStorage.removeItem('userEmail');
                    localStorage.removeItem('loginTime');
                    
                    console.log('Öğrenci çıkışı yapıldı');
                    window.location.href = 'index.html';
                });
            });
        }

        // Load downloadable resources from database
        async function loadDownloads() {
            try {
                console.log('📥 İndirilebilir kaynaklar yükleniyor...');
                
                // Wait for Firebase to be ready
                await new Promise(resolve => {
                    const checkDB = () => {
                        if (window.DB) {
                            resolve();
                        } else {
                            setTimeout(checkDB, 200);
                        }
                    };
                    checkDB();
                });
                
                // Get downloads from Firebase
                const downloadsResult = await window.DB.load('downloads');
                let downloads = (downloadsResult && downloadsResult.success) ? downloadsResult.data : [];
                
                if (downloads.length === 0) {
                    // Create sample downloads if none exist
                    await createSampleDownloads();
                    const newDownloadsResult = await window.DB.load('downloads');
                    downloads = (newDownloadsResult && newDownloadsResult.success) ? newDownloadsResult.data : [];
                }
                
                // Get user progress for personalized recommendations
                const userEmail = localStorage.getItem('userEmail');
                const progressResult = await window.DB.load('userProgress');
                const userProgress = (progressResult && progressResult.success) ? progressResult.data : [];
                const myProgress = userProgress.filter(p => p.userEmail === userEmail);
                
                // Load modules for filter dropdown
                await loadModules();
                
                displayDownloads(downloads);
                displayFeaturedResources(downloads);
                updateDownloadStats(downloads, myProgress);
                
            } catch (error) {
                console.error('❌ İndirilebilir kaynaklar yüklenirken hata:', error);
            }
        }

        // Load modules for filter dropdown
        async function loadModules() {
            try {
                console.log('📚 Modüller yükleniyor...');
                const modulesResult = await window.DB.loadModules();
                const modules = (modulesResult && modulesResult.success) ? modulesResult.data : [];
                
                // Update filter module select
                const filterModuleSelect = document.getElementById('filter-module');
                
                if (filterModuleSelect) {
                    filterModuleSelect.innerHTML = '<option value="">Tüm Modüller</option>';
                    
                    if (modules && modules.length > 0) {
                        modules.forEach(module => {
                            const option = document.createElement('option');
                            option.value = module.id;
                            option.textContent = module.title || module.name || 'Modül ' + module.id;
                            filterModuleSelect.appendChild(option);
                        });
                        console.log('✅ Filter modülleri başarıyla yüklendi:', modules.length);
                    }
                }
            } catch (error) {
                console.error('❌ Modül yükleme hatası:', error);
            }
        }
        
        // Display featured resources
        function displayFeaturedResources(downloads) {
            const container = document.getElementById('featured-resources');
            if (!container) return;
            
            // Get top 3 resources by rating or download count
            const featured = downloads
                .sort((a, b) => (b.rating || 0) - (a.rating || 0))
                .slice(0, 3);
            
            if (featured.length === 0) {
                container.innerHTML = `
                    <div class="col-span-3 text-center py-8">
                        <i class="fas fa-star text-4xl text-gray-300 mb-2"></i>
                        <p class="text-gray-500">Henüz öne çıkan kaynak bulunmuyor</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = featured.map(resource => `
                <div class="bg-gradient-to-br from-cyber/5 to-primary/5 rounded-lg p-4 border border-cyber/20">
                    <div class="flex items-center mb-3">
                        <div class="w-10 h-10 bg-cyber/10 text-cyber rounded-lg flex items-center justify-center mr-3">
                            <i class="fas ${getResourceIcon(resource.category)}"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900">${resource.title}</h3>
                            <p class="text-xs text-gray-600">${resource.fileSize || 'N/A'} • ${getCategoryName(resource.category)}</p>
                        </div>
                    </div>
                    <p class="text-sm text-gray-600 mb-3">${resource.description}</p>
                    <button onclick="downloadResource('${resource.id}', '${resource.downloadUrl}', '${resource.title}')" 
                            class="w-full bg-cyber text-white py-2 rounded-lg text-sm hover:bg-cyber/90">
                        <i class="fas fa-download mr-2"></i>İndir
                    </button>
                </div>
            `).join('');
        }

        // Get resource icon based on category
        function getResourceIcon(category) {
            const icons = {
                'pdf': 'fa-file-pdf text-red-500',
                'code': 'fa-code text-blue-500',
                'tool': 'fa-tools text-green-500',
                'template': 'fa-file-alt text-purple-500'
            };
            return icons[category] || 'fa-file text-gray-500';
        }

        // Get category name
        function getCategoryName(category) {
            const names = {
                'pdf': 'PDF',
                'code': 'Kod',
                'tool': 'Araç',
                'template': 'Şablon'
            };
            return names[category] || category;
        }
        
        // Display downloads in the UI
        function displayDownloads(downloads) {
            const container = document.getElementById('resources-container');
            if (!container) return;
            
            // Group downloads by category
            const categories = {
                'pdf': downloads.filter(d => d.category === 'pdf'),
                'code': downloads.filter(d => d.category === 'code'),
                'tool': downloads.filter(d => d.category === 'tool'),
                'template': downloads.filter(d => d.category === 'template')
            };
            
            const categoryNames = {
                'pdf': 'PDF Dokümanları',
                'code': 'Kod Örnekleri',
                'tool': 'Araçlar',
                'template': 'Şablonlar'
            };
            
            const categoryIcons = {
                'pdf': 'fas fa-file-pdf text-red-500',
                'code': 'fas fa-code text-blue-500',
                'tool': 'fas fa-tools text-green-500',
                'template': 'fas fa-file-alt text-purple-500'
            };
            
            container.innerHTML = Object.keys(categories)
                .filter(cat => categories[cat].length > 0)
                .map(category => `\n                    <div class="mb-8">\n                        <div class="flex items-center mb-4">\n                            <i class="${categoryIcons[category]} text-xl mr-3"></i>\n                            <h3 class="text-lg font-semibold text-gray-900">${categoryNames[category]}</h3>\n                            <span class="ml-2 text-sm text-gray-500">(${categories[category].length})</span>\n                        </div>\n                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">\n                            ${categories[category].map(resource => `\n                                <div class="bg-white rounded-lg border border-gray-200 p-4 hover:shadow-md transition-shadow">\n                                    <div class="flex items-start justify-between mb-3">\n                                        <div class="flex-1">\n                                            <h4 class="font-semibold text-gray-900 mb-1">${resource.title}</h4>\n                                            <p class="text-sm text-gray-600 mb-2">${resource.description}</p>\n                                            <div class="flex items-center space-x-3 text-xs text-gray-500">\n                                                <span><i class="fas fa-download mr-1"></i>${resource.downloadCount || 0}</span>\n                                                <span><i class="fas fa-file mr-1"></i>${resource.fileSize || 'N/A'}</span>\n                                                <span><i class="fas fa-star mr-1"></i>${resource.rating || '4.5'}</span>\n                                            </div>\n                                        </div>\n                                        <i class="${categoryIcons[category]} text-2xl"></i>\n                                    </div>\n                                    <div class="flex items-center justify-between">\n                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${
                                            resource.level === 'Başlangıç' ? 'bg-green-100 text-green-800' :
                                            resource.level === 'Orta' ? 'bg-yellow-100 text-yellow-800' :
                                            'bg-red-100 text-red-800'
                                        }">\n                                            ${resource.level || 'Orta'}\n                                        </span>\n                                        <button onclick="downloadResource('${resource.id}', '${resource.downloadUrl}', '${resource.title}')\" \n                                                class="bg-cyber text-white px-3 py-1 rounded text-sm hover:bg-cyber/90 transition-colors">\n                                            <i class="fas fa-download mr-1"></i>\n                                            İndir\n                                        </button>\n                                    </div>\n                                </div>\n                            `).join('')}\n                        </div>\n                    </div>\n                `).join('');
        }
        
        // Update download statistics
        function updateDownloadStats(downloads, userProgress) {
            const totalDownloads = downloads.length;
            const completedModules = userProgress.filter(p => p.completed).length;
            const userLevel = completedModules < 5 ? 'Başlangıç' : completedModules < 15 ? 'Orta' : 'İleri';
            const recommendedDownloads = downloads.filter(d => d.level === userLevel).length;
            
            // Update stats cards
            document.getElementById('total-resources').textContent = totalDownloads;
            document.getElementById('user-level').textContent = userLevel;
            document.getElementById('recommended-count').textContent = recommendedDownloads;
        }
        
        // Download resource function
        async function downloadResource(resourceId, downloadUrl, title) {
            try {
                console.log(`📥 İndiriliyor: ${title}`);
                
                // Update download count
                const downloadsResult = await window.DB.load('downloads');
                const downloads = (downloadsResult && downloadsResult.success) ? downloadsResult.data : [];
                const resource = downloads.find(d => d.id === resourceId);
                
                if (resource) {
                    resource.downloadCount = (resource.downloadCount || 0) + 1;
                    resource.lastDownloaded = new Date().toISOString();
                    await window.DB.save('downloads', resource, resourceId);
                }
                
                // Simulate download (in real app, this would be actual file download)
                if (downloadUrl && downloadUrl !== '#') {
                    window.open(downloadUrl, '_blank');
                } else {
                    // Create a demo download
                    const blob = new Blob([`# ${title}\n\nBu bir demo dosyasıdır.\nGerçek uygulamada buradan dosya indirilecektir.`], 
                        { type: 'text/plain' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${title.replace(/\s+/g, '_')}.txt`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                }
                
                // Show success message
                showNotification(`✅ ${title} başarıyla indirildi!`, 'success');
                
            } catch (error) {
                console.error('❌ İndirme hatası:', error);
                showNotification('❌ İndirme sırasında hata oluştu', 'error');
            }
        }
        
        // Create sample downloads
        async function createSampleDownloads() {
            console.log('📝 Örnek indirilebilir kaynaklar oluşturuluyor...');
            
            const sampleDownloads = [
                {
                    title: 'Kriptografi Algoritmaları Rehberi',
                    description: 'AES, RSA, SHA algoritmaları detaylı açıklamaları',
                    category: 'pdf',
                    level: 'Başlangıç',
                    fileSize: '2.5 MB',
                    downloadUrl: '#',
                    downloadCount: 156,
                    rating: 4.8,
                    createdAt: new Date().toISOString()
                },
                {
                    title: 'Python Kriptografi Kütüphanesi',
                    description: 'Python ile şifreleme işlemleri için kod örnekleri',
                    category: 'code',
                    level: 'Orta',
                    fileSize: '850 KB',
                    downloadUrl: '#',
                    downloadCount: 89,
                    rating: 4.6,
                    createdAt: new Date().toISOString()
                },
                {
                    title: 'Hash Cracking Araçları',
                    description: 'Parola kırma ve hash analiz araçları',
                    category: 'tool',
                    level: 'İleri',
                    fileSize: '15.2 MB',
                    downloadUrl: '#',
                    downloadCount: 234,
                    rating: 4.9,
                    createdAt: new Date().toISOString()
                },
                {
                    title: 'Güvenlik Politikası Şablonu',
                    description: 'Kurumsal güvenlik politikası hazırlama şablonu',
                    category: 'template',
                    level: 'Başlangıç',
                    fileSize: '125 KB',
                    downloadUrl: '#',
                    downloadCount: 67,
                    rating: 4.3,
                    createdAt: new Date().toISOString()
                },
                {
                    title: 'Blockchain Teknolojisi Kılavuzu',
                    description: 'Blockchain ve kripto para teknolojileri',
                    category: 'pdf',
                    level: 'İleri',
                    fileSize: '4.1 MB',
                    downloadUrl: '#',
                    downloadCount: 198,
                    rating: 4.7,
                    createdAt: new Date().toISOString()
                },
                {
                    title: 'RSA Şifreleme Uygulaması',
                    description: 'Java ile RSA algoritması implementasyonu',
                    category: 'code',
                    level: 'Orta',
                    fileSize: '1.2 MB',
                    downloadUrl: '#',
                    downloadCount: 112,
                    rating: 4.5,
                    createdAt: new Date().toISOString()
                }
            ];
            
            for (const download of sampleDownloads) {
                await window.DB.save('downloads', download);
            }
            
            console.log('✅ Örnek indirilebilir kaynaklar oluşturuldu');
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                'bg-blue-500'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html> 