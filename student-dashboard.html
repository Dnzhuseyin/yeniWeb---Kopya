<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - EduPlatform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e40af',
                        secondary: '#dc2626',
                        accent: '#059669',
                        cyber: '#6366f1',
                        dark: '#0f172a'
                    }
                },
                fontFamily: {
                    sans: ['Inter', 'sans-serif'],
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 min-h-screen flex">
    <!-- Sidebar -->
    <aside class="bg-dark text-white w-64 min-h-screen fixed left-0 top-0 z-20 hidden md:block">
        <div class="p-4">
            <a href="student-dashboard.html" class="font-bold text-xl text-cyber block mb-8 flex items-center">
                <i class="fas fa-graduation-cap text-2xl mr-3"></i>
                EduPlatform
            </a>
            
            <div class="mb-8">
                <div class="flex items-center mb-4">
                    <div>
                        <p class="font-medium" id="user-name"></p>
                        <p class="text-sm text-gray-400" id="user-email"></p>
                    </div>
                </div>
            </div>
            
            <nav class="space-y-1">
                <a href="student-dashboard.html" class="flex items-center px-4 py-3 rounded-lg bg-slate-800">
                    <i class="fas fa-tachometer-alt mr-3 text-cyber"></i>
                    <span>Genel BakÄ±ÅŸ</span>
                </a>
                <a href="courses.html" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-800">
                    <i class="fas fa-graduation-cap mr-3"></i>
                    <span>EÄŸitim ModÃ¼lleri</span>
                </a>
                <a href="progress.html" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-800">
                    <i class="fas fa-chart-line mr-3"></i>
                    <span>Ä°lerlemem</span>
                </a>
                <a href="my-notes.html" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-800">
                    <i class="fas fa-sticky-note mr-3"></i>
                    <span>NotlarÄ±m</span>
                </a>
                <a href="account.html" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-800">
                    <i class="fas fa-user-cog mr-3"></i>
                    <span>Profil AyarlarÄ±</span>
                </a>
            </nav>

            <div class="absolute bottom-0 left-0 w-full p-4 border-t border-slate-800">
                <a href="#" onclick="logout()" class="flex items-center text-gray-400 hover:text-white">
                    <i class="fas fa-sign-out-alt mr-3"></i>
                    <span>Ã‡Ä±kÄ±ÅŸ Yap</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- Main content -->
    <main class="md:ml-64 p-4 md:p-8 w-full min-h-screen">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <header class="mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900 mb-2">Genel BakÄ±ÅŸ</h1>
                        <p class="text-gray-600">Online EÄŸitim Platformu Ä°lerlemeniz</p>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-semibold text-gray-900" id="header-user-name"></p>
                        <p class="text-sm text-gray-500" id="user-department"></p>
                    </div>
                </div>
            </header>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-sm font-medium text-gray-600">Tamamlanan ModÃ¼ller</h3>
                        <div class="h-10 w-10 bg-accent/10 text-accent rounded-lg flex items-center justify-center">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                    <p class="text-2xl font-bold text-gray-900" id="completed-modules">0</p>
                    <p class="text-xs text-gray-500 mt-1">/ <span id="total-modules">8</span> modÃ¼l</p>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-sm font-medium text-gray-600">Ä°zlenen Videolar</h3>
                        <div class="h-10 w-10 bg-cyber/10 text-cyber rounded-lg flex items-center justify-center">
                            <i class="fas fa-play-circle"></i>
            </div>
        </div>
                    <p class="text-2xl font-bold text-gray-900" id="watched-videos">0</p>
                    <p class="text-xs text-gray-500 mt-1">/ <span id="total-videos">24</span> video</p>
    </div>

                <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-sm font-medium text-gray-600">SÄ±nav BaÅŸarÄ±sÄ±</h3>
                        <div class="h-10 w-10 bg-primary/10 text-primary rounded-lg flex items-center justify-center">
                            <i class="fas fa-trophy"></i>
                        </div>
                    </div>
                    <p class="text-2xl font-bold text-gray-900" id="exam-average">0</p>
                    <p class="text-xs text-gray-500 mt-1">ortalama puan</p>
            </div>
            
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-sm font-medium text-gray-600">Ã–ÄŸrenme Seviyesi</h3>
                            <div class="h-10 w-10 bg-secondary/10 text-secondary rounded-lg flex items-center justify-center">
                                <i class="fas fa-star"></i>
        </div>
                    </div>
                        <p class="text-2xl font-bold text-gray-900" id="security-level">BaÅŸlangÄ±Ã§</p>
                        <p class="text-xs text-gray-500 mt-1" id="security-description">Temel seviye</p>
                    </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Progress Overview -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-chart-line text-primary mr-2"></i>
                            Ä°lerleme Durumu
                        </h2>
                        
                        <div class="mb-6">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm font-medium text-gray-600">Genel Ä°lerleme</span>
                                <span class="text-sm font-bold text-primary" id="overall-progress">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-gradient-to-r from-primary to-cyber h-3 rounded-full transition-all duration-500" style="width: 0%" id="progress-bar"></div>
                            </div>
                        </div>
                        
                        <!-- Module Progress -->
                        <div class="space-y-4" id="module-progress-list">
                            <!-- Module progress will be loaded here -->
                        </div>
                    </div>

                    <!-- AI Learning Analysis -->
                    <div class="bg-white rounded-xl shadow-sm p-6" id="ai-analysis-section">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-brain text-cyber mr-2"></i>
                            AI Ã–ÄŸrenme Analizi
                        </h2>
                        
                        <div id="ai-analysis-content" class="space-y-4">
                            <!-- AI analysis content will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="lg:col-span-1">
                    <!-- Current Tasks -->
                    <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-tasks text-accent mr-2"></i>
                            Aktif GÃ¶revler
                        </h3>
                        
                        <div class="space-y-3" id="active-tasks">
                            <!-- Active tasks will be loaded here -->
                        </div>
                    </div>

                    <!-- Recent Achievements -->
                    <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-award text-yellow-500 mr-2"></i>
                            Son BaÅŸarÄ±lar
                        </h3>
                        
                        <div class="space-y-3" id="recent-achievements">
                            <!-- Recent achievements will be loaded here -->
                        </div>
                    </div>

                    <!-- Learning Tips -->
                    <div class="bg-gradient-to-br from-secondary/10 to-primary/10 rounded-xl p-6 border border-secondary/20">
                        <h3 class="text-lg font-semibold mb-4 flex items-center text-secondary">
                            <i class="fas fa-lightbulb mr-2"></i>
                            GÃ¼nÃ¼n Ã–ÄŸrenme Ä°pucu
                        </h3>
                        
                        <div class="bg-white/50 rounded-lg p-4" id="security-tip">
                            <!-- Learning tip will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
            
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    
    <!-- Firebase Production DB -->
    <script src="js/firebase-production.js"></script>
    <script src="js/user-utils.js"></script>
    <script src="js/groq-api.js"></script>
    <script src="js/main.js"></script>

    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize user info using UserUtils
            await UserUtils.initializeUserInfo();
            
            // Load Firebase data
            await loadDashboardData();
            await loadProgressOverview(); 
            await loadActiveTasks();
            await loadRecentAchievements();
            await loadSecurityTip();
            await loadAIAnalysis();
        });
        
        // Load real dashboard data from Firebase
        async function loadDashboardData() {
            try {
                const userEmail = localStorage.getItem('userEmail');
                if (!userEmail) return;
                
                console.log('ğŸ“Š Dashboard verileri yÃ¼kleniyor...');
                
                // Wait for Firebase to be ready
                await new Promise(resolve => {
                    const checkDB = () => {
                        if (window.DB) {
                            resolve();
                        } else {
                            setTimeout(checkDB, 100);
                        }
                    };
                    checkDB();
                });
                
                // Load user profile
                const profileResult = await window.DB.load('userProfiles');
                const profiles = (profileResult && profileResult.success) ? profileResult.data : [];
                const userProfile = profiles.find(p => p.userEmail === userEmail);
                
                if (userProfile) {
                    document.getElementById('user-department').textContent = getDepartmentName(userProfile.department);
                }
                
                // Load modules
                const modulesResult = await window.DB.loadModules();
                const modules = (modulesResult && modulesResult.success) ? modulesResult.data : [];
                
                // Load user progress
                const progressResult = await window.DB.load('userProgress');
                const progressData = (progressResult && progressResult.success) ? progressResult.data : [];
                const userProgressData = progressData.filter(p => p.userEmail === userEmail);
                
                // Load coordinator videos
                const videosResult = await window.DB.load('coordinatorVideos');
                const videos = (videosResult && videosResult.success) ? videosResult.data : [];
                
                // Calculate real statistics
                const completedModules = userProgressData.filter(p => p.completionRate >= 100).length;
                const totalModules = modules.length || 8;
                const watchedVideos = userProgressData.reduce((sum, p) => sum + (p.watchedVideos || 0), 0);
                const totalVideos = videos.length || 24;
                const examAverage = userProgressData.reduce((sum, p) => sum + (p.examScore || 0), 0) / Math.max(userProgressData.length, 1);
                
                // Update UI
                document.getElementById('completed-modules').textContent = completedModules;
                document.getElementById('total-modules').textContent = totalModules;
                document.getElementById('watched-videos').textContent = watchedVideos;
                document.getElementById('total-videos').textContent = totalVideos;
                document.getElementById('exam-average').textContent = Math.round(examAverage) || 0;
                
                // Update security level based on progress
                updateSecurityLevel(completedModules, totalModules, examAverage);
                
                console.log('âœ… Dashboard verileri yÃ¼klendi');
                
            } catch (error) {
                console.error('âŒ Dashboard veri yÃ¼kleme hatasÄ±:', error);
            }
        }
        
        // Load AI Learning Analysis
        async function loadAIAnalysis() {
            try {
                console.log('ğŸ¤– AI Ã¶ÄŸrenme analizi yÃ¼kleniyor...');
                
                const userEmail = localStorage.getItem('userEmail');
                if (!userEmail) return;
                
                // Get user's quiz responses and wrong answers
                const responsesResult = await window.DB.load('quizResponses');
                const responses = (responsesResult && responsesResult.success) ? responsesResult.data : [];
                const userResponses = responses.filter(r => r.userEmail === userEmail);
                
                // Get user's exam progress for wrong answers
                const progressResult = await window.DB.load('userProgress');
                const progressData = (progressResult && progressResult.success) ? progressResult.data : [];
                const userProgressData = progressData.filter(p => p.userEmail === userEmail);
                
                // Analyze recent wrong answers
                const wrongAnswers = [];
                userProgressData.forEach(progress => {
                    if (progress.wrongAnswers && progress.wrongAnswers.length > 0) {
                        wrongAnswers.push(...progress.wrongAnswers.slice(0, 3)); // Son 3 yanlÄ±ÅŸ cevap
                    }
                });
                
                if (wrongAnswers.length === 0) {
                    displayNoAnalysisMessage();
                    return;
                }
                
                // Generate AI analysis for wrong answers
                await generateAIAnalysisForWrongAnswers(wrongAnswers);
                
            } catch (error) {
                console.error('âŒ AI analizi yÃ¼klenirken hata:', error);
                displayNoAnalysisMessage();
            }
        }
        
        function displayNoAnalysisMessage() {
            const container = document.getElementById('ai-analysis-content');
            if (!container) return;
            
            container.innerHTML = `
                <div class="text-center py-8">
                    <i class="fas fa-brain text-4xl text-gray-300 mb-4"></i>
                    <h3 class="text-lg font-medium text-gray-600 mb-2">HenÃ¼z Analiz Edilecek Veri Yok</h3>
                    <p class="text-gray-500">SÄ±navlarÄ± Ã§Ã¶zdÃ¼kÃ§e yanlÄ±ÅŸ yaptÄ±ÄŸÄ±nÄ±z sorular analiz edilecek ve Ã¶neriler sunulacak.</p>
                </div>
            `;
        }
        
        async function generateAIAnalysisForWrongAnswers(wrongAnswers) {
            const container = document.getElementById('ai-analysis-content');
            if (!container) return;
            
            container.innerHTML = `
                <div class="text-center py-6">
                    <i class="fas fa-brain fa-spin text-3xl text-cyber mb-3"></i>
                    <p class="text-lg font-medium">AI Analiz YapÄ±yor...</p>
                    <p class="text-sm text-gray-600">YanlÄ±ÅŸ cevaplarÄ±nÄ±z analiz ediliyor...</p>
                </div>
            `;
            
            const analyses = [];
            
            for (let i = 0; i < Math.min(wrongAnswers.length, 3); i++) {
                const wrongAnswer = wrongAnswers[i];
                const analysis = await analyzeWrongAnswerAI(wrongAnswer);
                if (analysis) {
                    analyses.push(analysis);
                }
            }
            
            displayAIAnalysisResults(analyses);
        }
        
        async function analyzeWrongAnswerAI(wrongAnswer) {
            try {
                const api = window.GroqAPI || window.GeminiAPI;
                if (!api) {
                    return generateFallbackAnalysis(wrongAnswer);
                }
                
                const context = `Sen bir siber gÃ¼venlik eÄŸitim uzmanÄ±sÄ±n. Ã–ÄŸrencinin yanlÄ±ÅŸ cevapladÄ±ÄŸÄ± sorularÄ± analiz edip hatalarÄ±nÄ± aÃ§Ä±klÄ±yorsun. TÃ¼rkÃ§e yanÄ±t ver.`;
                
                const prompt = `Bu yanlÄ±ÅŸ cevaplanan soruyu analiz et ve Ã¶ÄŸrenciye aÃ§Ä±kla:

SORU: ${wrongAnswer.question}
Ã–ÄRENCÄ°NÄ°N YANLIÅ CEVABI: ${wrongAnswer.userAnswer}
DOÄRU CEVAP: ${wrongAnswer.correctAnswer}

LÃ¼tfen ÅŸu analizi yap:
1. Ã–ÄŸrencinin neden bu hatayÄ± yaptÄ±ÄŸÄ±nÄ± aÃ§Ä±kla
2. DoÄŸru cevabÄ±n neden doÄŸru olduÄŸunu detaylÄ± aÃ§Ä±kla
3. Bu konuda dikkat edilmesi gereken Ã¶nemli noktalarÄ± belirt
4. Benzer hatalar yapmamak iÃ§in Ã¶neriler sun

JSON formatÄ±nda dÃ¶ndÃ¼r:
{
    "hataAciklamasi": "Neden yanlÄ±ÅŸ cevap verildiÄŸinin aÃ§Ä±klamasÄ±",
    "dogruCevapAciklamasi": "DoÄŸru cevabÄ±n detaylÄ± aÃ§Ä±klamasÄ±",
    "onemliNoktalar": ["nokta 1", "nokta 2", "nokta 3"],
    "oneriler": ["Ã¶neri 1", "Ã¶neri 2"]
}`;

                const result = await api.generateContent(prompt, context);
                
                if (result.success) {
                    const jsonMatch = result.text.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        const analysis = JSON.parse(jsonMatch[0]);
                        return {
                            ...analysis,
                            originalQuestion: wrongAnswer.question,
                            wrongAnswer: wrongAnswer.userAnswer,
                            correctAnswer: wrongAnswer.correctAnswer
                        };
                    }
                }
                
                return generateFallbackAnalysis(wrongAnswer);
                
            } catch (error) {
                console.error('âŒ AI analiz hatasÄ±:', error);
                return generateFallbackAnalysis(wrongAnswer);
            }
        }
        
        function generateFallbackAnalysis(wrongAnswer) {
            return {
                originalQuestion: wrongAnswer.question,
                wrongAnswer: wrongAnswer.userAnswer,
                correctAnswer: wrongAnswer.correctAnswer,
                hataAciklamasi: "Bu soruda konuyla ilgili temel kavramlarÄ± karÄ±ÅŸtÄ±rmÄ±ÅŸ olabilirsiniz.",
                dogruCevapAciklamasi: "DoÄŸru cevap bu konu hakkÄ±nda daha detaylÄ± bilgi gerektirir.",
                onemliNoktalar: [
                    "Konu ile ilgili temel kavramlarÄ± tekrar gÃ¶zden geÃ§irin",
                    "Benzer Ã¶rnekleri inceleyin",
                    "Pratik yaparak konuyu pekiÅŸtirin"
                ],
                oneriler: [
                    "Ä°lgili modÃ¼lÃ¼ tekrar izleyin",
                    "Not alarak Ã§alÄ±ÅŸÄ±n"
                ]
            };
        }
        
        function displayAIAnalysisResults(analyses) {
            const container = document.getElementById('ai-analysis-content');
            if (!container) return;
            
            if (analyses.length === 0) {
                displayNoAnalysisMessage();
                return;
            }
            
            container.innerHTML = analyses.map((analysis, index) => `
                <div class="border border-gray-200 rounded-lg p-4 mb-4">
                    <div class="flex items-start space-x-3 mb-3">
                        <div class="w-8 h-8 bg-red-100 text-red-600 rounded-full flex items-center justify-center font-bold text-sm">
                            ${index + 1}
                        </div>
                        <div class="flex-1">
                            <h4 class="font-medium text-gray-900 mb-2">${analysis.originalQuestion}</h4>
                            <div class="text-sm space-y-1">
                                <p><span class="font-medium text-red-600">YanlÄ±ÅŸ CevabÄ±nÄ±z:</span> ${analysis.wrongAnswer}</p>
                                <p><span class="font-medium text-green-600">DoÄŸru Cevap:</span> ${analysis.correctAnswer}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-red-50 border border-red-200 rounded-lg p-3 mb-3">
                        <h5 class="font-medium text-red-800 mb-1">ğŸ” Hata Analizi:</h5>
                        <p class="text-sm text-red-700">${analysis.hataAciklamasi}</p>
                    </div>
                    
                    <div class="bg-green-50 border border-green-200 rounded-lg p-3 mb-3">
                        <h5 class="font-medium text-green-800 mb-1">âœ… DoÄŸru Cevap AÃ§Ä±klamasÄ±:</h5>
                        <p class="text-sm text-green-700">${analysis.dogruCevapAciklamasi}</p>
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-3">
                        <h5 class="font-medium text-blue-800 mb-2">ğŸ’¡ Ã–nemli Noktalar:</h5>
                        <ul class="text-sm text-blue-700 space-y-1">
                            ${analysis.onemliNoktalar.map(nokta => `<li>â€¢ ${nokta}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-3">
                        <h5 class="font-medium text-purple-800 mb-2">ğŸ¯ Ã–neriler:</h5>
                        <ul class="text-sm text-purple-700 space-y-1">
                            ${analysis.oneriler.map(oneri => `<li>â€¢ ${oneri}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `).join('');
        }
        
        // Load progress overview
        async function loadProgressOverview() {
            try {
                const userEmail = localStorage.getItem('userEmail');
                if (!userEmail) return;
                
                console.log('ğŸ“Š Ä°lerleme Ã¶zeti yÃ¼kleniyor...');
                
                // Get modules and user progress
                const modulesResult = await window.DB.loadModules();
                const modules = (modulesResult && modulesResult.success) ? modulesResult.data : [];
                
                const progressResult = await window.DB.load('userProgress');
                const progressData = (progressResult && progressResult.success) ? progressResult.data : [];
                const userProgressData = progressData.filter(p => p.userEmail === userEmail);
                
                // Calculate overall progress
                const totalModules = modules.length || 8;
                const completedModules = userProgressData.filter(p => p.completionRate >= 100).length;
                const totalProgress = Math.round((completedModules / totalModules) * 100);
                
                // Update progress overview UI
                updateProgressOverviewUI(totalProgress, completedModules, totalModules);
                
                // Load module progress list
                await loadModuleProgressList(modules, userProgressData);
                
            } catch (error) {
                console.error('âŒ Progress overview yÃ¼kleme hatasÄ±:', error);
            }
        }
        
        // Update progress overview UI
        function updateProgressOverviewUI(totalProgress, completedModules, totalModules) {
            // Update progress bar
            const progressBar = document.getElementById('progress-bar');
            if (progressBar) {
                progressBar.style.width = `${totalProgress}%`;
            }
            
            // Update overall progress text
            const overallProgress = document.getElementById('overall-progress');
            if (overallProgress) {
                overallProgress.textContent = `${totalProgress}%`;
            }
            
            // Update security level based on progress
            updateSecurityLevel(completedModules, totalModules, totalProgress);
        }
        
        // Load module progress list
        async function loadModuleProgressList(modules, userProgressData) {
            const moduleProgressList = document.getElementById('module-progress-list');
            if (!moduleProgressList) return;
            
            // Use modules from database or create sample ones if none exist
            let cyberModules = modules;
            if (!cyberModules || cyberModules.length === 0) {
                console.log('âš ï¸ HiÃ§ modÃ¼l bulunamadÄ±, Ã¶rnek modÃ¼ller oluÅŸturuluyor...');
                await createSampleModules();
                const newModulesResult = await window.DB.loadModules();
                cyberModules = (newModulesResult && newModulesResult.success) ? newModulesResult.data : [];
            }
            
            moduleProgressList.innerHTML = '';
            
            cyberModules.forEach(module => {
                const userProgress = userProgressData.find(p => p.moduleId === module.id) || { completionRate: 0 };
                const progressPercent = userProgress.completionRate || 0;
                
                const moduleDiv = document.createElement('div');
                moduleDiv.className = 'flex items-center justify-between p-4 bg-gray-50 rounded-lg';
                moduleDiv.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <div class="w-10 h-10 bg-gradient-to-br from-cyber to-primary rounded-lg flex items-center justify-center">
                            <i class="fas ${getModuleIcon(module.id)} text-white"></i>
                                </div>
                                <div>
                            <h4 class="font-medium text-gray-900">${module.title}</h4>
                            <p class="text-sm text-gray-600">${module.description}</p>
                            </div>
                    </div>
                    <div class="text-right">
                        <div class="w-16 h-2 bg-gray-200 rounded-full">
                            <div class="h-2 bg-gradient-to-r from-cyber to-primary rounded-full" style="width: ${progressPercent}%"></div>
                                </div>
                        <p class="text-xs text-gray-500 mt-1">${Math.round(progressPercent)}%</p>
                                </div>
                `;
                moduleProgressList.appendChild(moduleDiv);
            });
        }

        // Create sample modules if none exist
        async function createSampleModules() {
            try {
                console.log('ğŸ”§ Ã–rnek modÃ¼ller oluÅŸturuluyor...');
                const sampleModules = [
                    {
                        title: 'Temel Programlama',
                        description: 'Programlama mantÄ±ÄŸÄ±, algoritma geliÅŸtirme ve temel kavramlar',
                        category: 'Temel',
                        difficulty: 'beginner',
                        order: 1
                    },
                    {
                        title: 'Web GeliÅŸtirme',
                        description: 'HTML, CSS, JavaScript ile modern web uygulamalarÄ±',
                        category: 'Web',
                        difficulty: 'intermediate',
                        order: 2
                    },
                    {
                        title: 'Veri Analizi',
                        description: 'Veri iÅŸleme, analiz teknikleri ve gÃ¶rselleÅŸtirme',
                        category: 'Analiz',
                        difficulty: 'intermediate',
                        order: 3
                    },
                    {
                        title: 'Mobil Uygulama GeliÅŸtirme',
                        description: 'iOS ve Android platformlarÄ± iÃ§in uygulama geliÅŸtirme',
                        category: 'Mobil',
                        difficulty: 'advanced',
                        order: 4
                    },
                    {
                        title: 'VeritabanÄ± YÃ¶netimi',
                        description: 'SQL, NoSQL ve veritabanÄ± tasarÄ±m prensipleri',
                        category: 'VeritabanÄ±',
                        difficulty: 'advanced',
                        order: 5
                    }
                ];

                for (const module of sampleModules) {
                    await window.DB.saveModule(module);
                }
                console.log('âœ… Ã–rnek modÃ¼ller oluÅŸturuldu');
            } catch (error) {
                console.error('âŒ Ã–rnek modÃ¼l oluÅŸturma hatasÄ±:', error);
            }
        }
        
        // Load active tasks
        async function loadActiveTasks() {
            try {
                const userEmail = localStorage.getItem('userEmail');
                if (!userEmail) return;
                
                // Get user progress to determine tasks
                const progressResult = await window.DB.load('userProgress');
                const progressData = (progressResult && progressResult.success) ? progressResult.data : [];
                const userProgressData = progressData.filter(p => p.userEmail === userEmail);
                
                const completedModules = userProgressData.filter(p => p.completionRate >= 100).length;
                const activeTasksContainer = document.getElementById('active-tasks');
                
                let tasks = [];
                
                if (completedModules === 0) {
                    tasks = [
                        { name: 'Ä°lk ModÃ¼lÃ¼ BaÅŸlat', status: 'Bekliyor', color: 'cyber', icon: 'fa-play' },
                        { name: 'Profil Bilgilerini Tamamla', status: 'Bekliyor', color: 'accent', icon: 'fa-user' }
                    ];
                } else if (completedModules < 3) {
                    tasks = [
                        { name: 'Kriptoloji ModÃ¼lÃ¼nÃ¼ Tamamla', status: 'Devam Ediyor', color: 'primary', icon: 'fa-key' },
                        { name: 'Ä°lk SÄ±navÄ± GeÃ§', status: 'HazÄ±r', color: 'secondary', icon: 'fa-clipboard-check' }
                    ];
                } else if (completedModules < 6) {
                    tasks = [
                        { name: 'Penetrasyon Testi PratiÄŸi', status: 'Yeni', color: 'secondary', icon: 'fa-bug' },
                        { name: 'GÃ¼venlik Projesi', status: 'Devam Ediyor', color: 'accent', icon: 'fa-project-diagram' }
                    ];
                } else {
                    tasks = [
                        { name: 'Final Projesi', status: 'HazÄ±r', color: 'primary', icon: 'fa-trophy' },
                        { name: 'Sertifika SÄ±navÄ±', status: 'Bekliyor', color: 'cyber', icon: 'fa-certificate' }
                    ];
                }
                
                activeTasksContainer.innerHTML = tasks.map(task => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-${task.color}/10 text-${task.color} rounded-lg flex items-center justify-center">
                                <i class="fas ${task.icon}"></i>
                            </div>
                            <div>
                                <p class="font-medium text-gray-900 text-sm">${task.name}</p>
                                <p class="text-xs text-gray-500">${task.status}</p>
                            </div>
                        </div>
                        <span class="text-xs px-2 py-1 bg-${task.color}/10 text-${task.color} rounded-full">${task.status}</span>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('âŒ Active tasks yÃ¼kleme hatasÄ±:', error);
            }
        }
        
        // Load recent achievements
        async function loadRecentAchievements() {
            try {
                const userEmail = localStorage.getItem('userEmail');
                if (!userEmail) return;
                
                // Get user progress to determine achievements
                const progressResult = await window.DB.load('userProgress');
                const progressData = (progressResult && progressResult.success) ? progressResult.data : [];
                const userProgressData = progressData.filter(p => p.userEmail === userEmail);
                
                const recentAchievementsContainer = document.getElementById('recent-achievements');
                const completedModules = userProgressData.filter(p => p.completionRate >= 100).length;
                
                let achievements = [];
                
                if (completedModules >= 1) {
                    achievements.push({
                        title: 'Ä°lk AdÄ±m',
                        description: 'Ä°lk modÃ¼lÃ¼ tamamladÄ±nÄ±z',
                        icon: 'fa-star',
                        color: 'accent',
                        date: 'BugÃ¼n'
                    });
                }
                
                if (completedModules >= 3) {
                    achievements.push({
                        title: 'GÃ¼venlik UzmanÄ±',
                        description: 'Temel gÃ¼venlik modÃ¼llerini tamamladÄ±nÄ±z',
                        icon: 'fa-shield-alt',
                        color: 'primary',
                        date: '2 gÃ¼n Ã¶nce'
                    });
                }
                
                if (completedModules >= 5) {
                    achievements.push({
                        title: 'Kriptoloji UstasÄ±',
                        description: 'Åifreleme konularÄ±nda uzmanlaÅŸtÄ±nÄ±z',
                        icon: 'fa-key',
                        color: 'cyber',
                        date: '1 hafta Ã¶nce'
                    });
                }
                
                if (achievements.length === 0) {
                    achievements = [
                        {
                            title: 'HoÅŸ Geldiniz!',
                            description: 'EÄŸitime baÅŸladÄ±ÄŸÄ±nÄ±z iÃ§in tebrikler',
                            icon: 'fa-graduation-cap',
                            color: 'cyber',
                            date: 'Yeni'
                        }
                    ];
                }
                
                recentAchievementsContainer.innerHTML = achievements.map(achievement => `
                    <div class="flex items-center space-x-3 p-3 bg-${achievement.color}/5 rounded-lg border border-${achievement.color}/20">
                        <div class="w-8 h-8 bg-${achievement.color}/10 text-${achievement.color} rounded-lg flex items-center justify-center">
                            <i class="fas ${achievement.icon}"></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-medium text-gray-900 text-sm">${achievement.title}</p>
                            <p class="text-xs text-gray-600">${achievement.description}</p>
                        </div>
                        <span class="text-xs text-gray-500">${achievement.date}</span>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('âŒ Recent achievements yÃ¼kleme hatasÄ±:', error);
            }
        }
        
        // Load learning tip
        function loadSecurityTip() {
            const learningTips = [
                "DÃ¼zenli Ã§alÄ±ÅŸma programÄ± oluÅŸturmak Ã¶ÄŸrenme verimliliÄŸinizi artÄ±rÄ±r.",
                "Not alarak Ã§alÄ±ÅŸmak bilgilerin kalÄ±cÄ±lÄ±ÄŸÄ±nÄ± %70 artÄ±rÄ±r.",
                "Ã–ÄŸrendiklerinizi baÅŸkalarÄ±na anlatmak konuyu daha iyi kavramanÄ±zÄ± saÄŸlar.",
                "KÄ±sa molalar vererek Ã§alÄ±ÅŸmak konsantrasyonunuzu artÄ±rÄ±r.",
                "FarklÄ± Ã¶ÄŸrenme yÃ¶ntemlerini deneyerek size en uygun olanÄ± bulun.",
                "Hedefler belirleyerek Ã§alÄ±ÅŸmak motivasyonunuzu yÃ¼ksek tutar.",
                "Tekrar yaparak Ã¶ÄŸrendiklerinizi pekiÅŸtirin.",
                "Merak ettiÄŸiniz konularda araÅŸtÄ±rma yaparak bilginizi derinleÅŸtirin."
            ];
            
            const randomTip = learningTips[Math.floor(Math.random() * learningTips.length)];
            const securityTipContainer = document.getElementById('security-tip');
            
            securityTipContainer.innerHTML = `
                <div class="flex items-start space-x-3">
                    <i class="fas fa-lightbulb text-secondary text-lg mt-1"></i>
                    <p class="text-sm text-gray-700 leading-relaxed">${randomTip}</p>
                </div>
            `;
        }
        
        // Update learning level
        function updateSecurityLevel(completedModules, totalModules, examAverage) {
            const progressPercent = (completedModules / totalModules) * 100;
            let level = 'BaÅŸlangÄ±Ã§';
            let description = 'Temel seviye';
            
            if (progressPercent >= 90 && examAverage >= 85) {
                level = 'Uzman';
                description = 'Uzman seviye';
            } else if (progressPercent >= 70 && examAverage >= 75) {
                level = 'Ä°leri Ã–ÄŸrenci';
                description = 'Ä°leri seviye';
            } else if (progressPercent >= 50 && examAverage >= 65) {
                level = 'Orta Seviye';
                description = 'Orta seviye';
            } else if (progressPercent >= 25) {
                level = 'GeliÅŸen Ã–ÄŸrenci';
                description = 'GeliÅŸen seviye';
            }
            
            document.getElementById('security-level').textContent = level;
            document.getElementById('security-description').textContent = description;
        }
        
        // Helper functions
        function getDepartmentName(departmentCode) {
            const departments = {
                'bilgisayar-muhendisligi': 'Bilgisayar MÃ¼hendisliÄŸi',
                'bilisim-sistemleri': 'BiliÅŸim Sistemleri',
                'siber-guvenlik': 'Siber GÃ¼venlik',
                'yazilim-muhendisligi': 'YazÄ±lÄ±m MÃ¼hendisliÄŸi',
                'bilgisayar-programciligi': 'Bilgisayar ProgramcÄ±lÄ±ÄŸÄ±'
            };
            return departments[departmentCode] || 'Bilgi Teknolojileri';
        }
        
        function getModuleIcon(moduleId) {
            const icons = {
                1: 'fa-graduation-cap',
                2: 'fa-code',
                3: 'fa-chart-bar',
                4: 'fa-mobile-alt',
                5: 'fa-database',
                6: 'fa-project-diagram',
                7: 'fa-book',
                8: 'fa-certificate'
            };
            return icons[moduleId] || 'fa-book';
        }
        
        // Logout function
        function logout() {
            if (confirm('Ã‡Ä±kÄ±ÅŸ yapmak istediÄŸinizden emin misiniz?')) {
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('userEmail');
                localStorage.removeItem('loginTime');
                localStorage.removeItem('userRole');
                
                console.log('ğŸšª Ã–ÄŸrenci Ã§Ä±kÄ±ÅŸÄ± yapÄ±ldÄ±');
                window.location.href = 'index.html';
            }
        }
    </script>
</body>
</html> 