<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Y√∂netimi - EduPlatform Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e40af',
                        secondary: '#dc2626',
                        accent: '#059669',
                        cyber: '#6366f1',
                        dark: '#0f172a'
                    }
                },
                fontFamily: {
                    sans: ['Inter', 'sans-serif'],
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ULTRA STRONG SIDEBAR FIX - NEVER DISAPPEAR */
        .sidebar-container {
            position: fixed !important;
            left: 0 !important;
            top: 0 !important;
            width: 256px !important;
            height: 100vh !important;
            z-index: 999999 !important;
            background-color: #0f172a !important;
            overflow-y: auto !important;
            transform: none !important;
            will-change: auto !important;
            pointer-events: auto !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .main-content {
            margin-left: 256px !important;
            z-index: 1 !important;
            position: relative !important;
        }
        
        /* Force sidebar to stay visible - ULTRA STRONG */
        body > aside {
            position: fixed !important;
            z-index: 999999 !important;
            left: 0 !important;
            top: 0 !important;
            height: 100vh !important;
            overflow-y: auto !important;
            transform: none !important;
            will-change: auto !important;
            pointer-events: auto !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        /* Additional safety measures */
        aside.sidebar-container {
            position: fixed !important;
            z-index: 999999 !important;
            left: 0 !important;
            top: 0 !important;
            height: 100vh !important;
            overflow-y: auto !important;
            transform: none !important;
            will-change: auto !important;
            pointer-events: auto !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Sidebar - ULTRA STRONG FIXED - NEVER DISAPPEAR -->
    <aside class="sidebar-container bg-dark text-white w-64 min-h-screen hidden md:block">
        <div class="p-4">
            <a href="instructor-dashboard.html" class="font-bold text-xl text-secondary block mb-8 flex items-center">
                <i class="fas fa-graduation-cap text-2xl mr-3"></i>
                EduPlatform Admin
            </a>
            
            <div class="mb-8">
                <div class="flex items-center mb-4">
                    <div>
                        <p class="font-medium" id="instructor-name"></p>
                        <p class="text-sm text-gray-400" id="instructor-email"></p>
                    </div>
                </div>
            </div>
            
            <nav class="space-y-1">
                <a href="instructor-dashboard.html" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-800">
                    <i class="fas fa-tachometer-alt mr-3"></i>
                    <span>Genel Bakƒ±≈ü</span>
                </a>
                <a href="instructor-courses.html" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-800">
                    <i class="fas fa-graduation-cap mr-3"></i>
                    <span>Eƒüitim Mod√ºlleri</span>
                </a>
                <a href="instructor-content.html" class="flex items-center px-4 py-3 rounded-lg bg-slate-800">
                    <i class="fas fa-video mr-3 text-secondary"></i>
                    <span>Video Y√∂netimi</span>
                </a>
                <a href="instructor-students.html" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-800">
                    <i class="fas fa-users mr-3"></i>
                    <span>√ñƒürenci Y√∂netimi</span>
                </a>
                <a href="instructor-quiz.html" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-800">
                    <i class="fas fa-question-circle mr-3"></i>
                    <span>Soru Y√∂netimi</span>
                </a>
            </nav>

            <div class="absolute bottom-0 left-0 w-full p-4 border-t border-slate-800">
                <button onclick="logout()" class="flex items-center text-gray-400 hover:text-white w-full text-left">
                    <i class="fas fa-sign-out-alt mr-3"></i>
                    <span>√áƒ±kƒ±≈ü Yap</span>
                </button>
            </div>
        </div>
    </aside>

    <!-- Main content -->
    <main class="main-content p-4 md:p-8 w-full min-h-screen">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <header class="mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900 mb-2">Video Y√∂netimi</h1>
                        <p class="text-gray-600">Siber g√ºvenlik eƒüitim videolarƒ±nƒ± y√∂netin ve AI ile sorular olu≈üturun</p>
                    </div>
                    <button class="bg-cyber text-white px-4 py-2 rounded-lg flex items-center" id="add-video-btn">
                        <i class="fas fa-plus mr-2"></i>
                        Yeni Video Ekle
                    </button>
                </div>
            </header>

            <!-- Video Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-sm font-medium text-gray-600">Toplam Video</h3>
                        <div class="h-10 w-10 bg-cyber/10 text-cyber rounded-lg flex items-center justify-center">
                            <i class="fas fa-video"></i>
                        </div>
                    </div>
                    <p class="text-2xl font-bold text-gray-900" id="total-videos">0</p>
                    <p class="text-xs text-gray-500 mt-1">y√ºklenen video</p>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-sm font-medium text-gray-600">Toplam Soru</h3>
                        <div class="h-10 w-10 bg-primary/10 text-primary rounded-lg flex items-center justify-center">
                            <i class="fas fa-question-circle"></i>
                        </div>
                    </div>
                    <p class="text-2xl font-bold text-gray-900" id="total-questions">0</p>
                    <p class="text-xs text-gray-500 mt-1">AI ile olu≈üturulan</p>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-sm font-medium text-gray-600">Aktif Mod√ºl</h3>
                        <div class="h-10 w-10 bg-accent/10 text-accent rounded-lg flex items-center justify-center">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                    </div>
                    <p class="text-2xl font-bold text-gray-900" id="active-modules">8</p>
                    <p class="text-xs text-gray-500 mt-1">siber g√ºvenlik mod√ºl√º</p>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-sm font-medium text-gray-600">ƒ∞zlenme</h3>
                        <div class="h-10 w-10 bg-secondary/10 text-secondary rounded-lg flex items-center justify-center">
                            <i class="fas fa-eye"></i>
                        </div>
                    </div>
                    <p class="text-2xl font-bold text-gray-900" id="total-views">2,547</p>
                    <p class="text-xs text-gray-500 mt-1">toplam g√∂r√ºnt√ºlenme</p>
                </div>
            </div>

            <!-- Video Upload Section - YENƒ∞ TASARIM -->
            <div class="bg-white rounded-xl shadow-sm p-6 mb-8 border border-gray-100">
                <h2 class="text-xl font-semibold mb-6 flex items-center">
                    <i class="fas fa-cloud-upload-alt text-cyber mr-2"></i>
                    Yeni Video Ekle
                </h2>
                
                <form id="videoForm" class="space-y-6">
                    <!-- Video Bilgileri -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-semibold mb-4 text-gray-700">1. Video Bilgileri</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Video Ba≈ülƒ±ƒüƒ± *</label>
                                <input type="text" id="videoTitle" required
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyber focus:border-transparent"
                                       placeholder="√ñrn: Kriptoloji Temelleri">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Mod√ºl *</label>
                                <select id="videoModule" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyber focus:border-transparent">
                                    <option value="">Mod√ºl Se√ßin</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Video A√ßƒ±klamasƒ± *</label>
                            <textarea id="videoDescription" rows="3" required
                                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyber focus:border-transparent"
                                      placeholder="Video i√ßeriƒüi hakkƒ±nda detaylƒ± a√ßƒ±klama..."></textarea>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">YouTube URL *</label>
                                <input type="url" id="youtubeUrl" required
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyber focus:border-transparent"
                                       placeholder="https://youtube.com/...">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">S√ºre (dk) *</label>
                                <input type="number" id="videoDuration" min="1" required
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyber focus:border-transparent"
                                       placeholder="45">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Zorluk *</label>
                                <select id="difficulty-level" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyber focus:border-transparent">
                                    <option value="">Se√ßin</option>
                                    <option value="beginner">Ba≈ülangƒ±√ß</option>
                                    <option value="intermediate">Orta</option>
                                    <option value="advanced">ƒ∞leri</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sorular B√∂l√ºm√º -->
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h3 class="font-semibold mb-4 text-blue-800">2. Video Sorularƒ± (Opsiyonel)</h3>
                        <p class="text-sm text-gray-600 mb-4">Video i√ßin farklƒ± tipte sorular ekleyebilirsiniz.</p>
                        
                        <div class="flex gap-2 mb-4">
                            <button type="button" onclick="addNewVideoQuestion('multiple-choice')" class="flex-1 bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90">
                                <i class="fas fa-list mr-2"></i>√áoktan Se√ßmeli
                            </button>
                            <button type="button" onclick="addNewVideoQuestion('open-ended')" class="flex-1 bg-accent text-white px-4 py-2 rounded-lg hover:bg-accent/90">
                                <i class="fas fa-comment-alt mr-2"></i>A√ßƒ±k U√ßlu
                            </button>
                            <button type="button" onclick="addNewVideoQuestion('fill-blank')" class="flex-1 bg-secondary text-white px-4 py-2 rounded-lg hover:bg-secondary/90">
                                <i class="fas fa-edit mr-2"></i>Bo≈üluk Doldurma
                            </button>
                        </div>
                        
                        <div id="video-questions-container" class="space-y-4">
                            <!-- Sorular buraya eklenecek -->
                        </div>
                    </div>
                    
                    <!-- Kaydet Butonu -->
                    <div class="flex items-center justify-between pt-4 border-t">
                        <p class="text-sm text-gray-500">* i≈üaretli alanlar zorunludur</p>
                        <div class="flex space-x-4">
                            <button type="button" onclick="resetVideoForm()" class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600">
                                <i class="fas fa-redo mr-2"></i>
                                Formu Temizle
                            </button>
                            <button type="submit" class="bg-cyber text-white px-6 py-3 rounded-lg hover:bg-cyber/90">
                                <i class="fas fa-save mr-2"></i>
                                Videoyu Kaydet
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Manual Questions Section -->
            <div id="manual-questions-section" class="bg-white rounded-xl shadow-sm p-6 mb-8 border border-gray-100" style="display: none;">
                <h2 class="text-xl font-semibold mb-6 flex items-center">
                    <i class="fas fa-edit text-primary mr-2"></i>
                    Manuel Soru Olu≈üturma
                </h2>
                
                <div id="manual-questions-container" class="space-y-6">
                    <!-- Manual questions will be added here -->
                </div>
                
                <div class="flex items-center space-x-4 mt-6">
                    <button type="button" onclick="addNewManualQuestion()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90">
                        <i class="fas fa-plus mr-2"></i>
                        Yeni Soru Ekle
                    </button>
                    <button type="button" onclick="saveManualQuestions()" class="bg-accent text-white px-4 py-2 rounded-lg hover:bg-accent/90">
                        <i class="fas fa-save mr-2"></i>
                        Sorularƒ± Kaydet
                    </button>
                    <button type="button" onclick="cancelManualQuestions()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">
                        <i class="fas fa-times mr-2"></i>
                        ƒ∞ptal
                    </button>
                </div>
            </div>

            <!-- Videos List -->
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold flex items-center">
                        <i class="fas fa-video text-primary mr-2"></i>
                        Y√ºklenen Videolar
                    </h2>
                    <div class="flex items-center space-x-3">
                        <select class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyber focus:border-transparent text-sm" id="filterModule">
                            <option value="">T√ºm Mod√ºller</option>
                        </select>
                    </div>
                </div>
                
                <div class="space-y-4" id="videos-container">
                    <!-- Videos will be loaded here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    
    <!-- Firebase Production DB -->
    <script src="js/firebase-production.js"></script>
    <script src="js/user-utils.js"></script>
    <script src="js/groq-api.js"></script>
    <script src="js/main.js"></script>
    <script>
        let currentVideoId = null;
        let questionCount = 0;
        let editingVideoId = null;
        let currentVideoQuestions = []; // New variable to hold manual questions for the current video

        // YouTube URL validation function - moved to top for hoisting
        function isValidYouTubeUrl(url) {
            if (!url) return false;
            
            // YouTube URL patterns
            const youtubePatterns = [
                /^https?:\/\/(www\.)?youtube\.com\/watch\?v=([a-zA-Z0-9_-]{11})/,
                /^https?:\/\/(www\.)?youtu\.be\/([a-zA-Z0-9_-]{11})/,
                /^https?:\/\/(www\.)?youtube\.com\/embed\/([a-zA-Z0-9_-]{11})/
            ];
            
            return youtubePatterns.some(pattern => pattern.test(url));
        }
        
        // Extract YouTube video ID from URL - moved to top for hoisting
        function extractYouTubeVideoId(url) {
            if (!url) return null;
            
            const patterns = [
                /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/
            ];
            
            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match) return match[1];
            }
            
            return null;
        }

        // Update stats function - moved to top for hoisting
        async function updateStats() {
            try {
                // Calculate stats manually since getStats might not exist
                const videosResult = await window.DB.load('coordinatorVideos');
                const videos = (videosResult && videosResult.success) ? videosResult.data : [];
                
                const totalVideos = videos.length;
                const totalQuestions = videos.reduce((sum, video) => {
                    return sum + (video.questions ? video.questions.length : 0);
                }, 0);
                
                // Update UI elements if they exist
                const totalVideosEl = document.getElementById('total-videos');
                const totalQuestionsEl = document.getElementById('total-questions');
                
                if (totalVideosEl) totalVideosEl.textContent = totalVideos;
                if (totalQuestionsEl) totalQuestionsEl.textContent = totalQuestions;
                
                console.log('üìä ƒ∞statistikler g√ºncellendi:', { totalVideos, totalQuestions });
                
            } catch (error) {
                console.error('‚ùå ƒ∞statistik g√ºncelleme hatasƒ±:', error);
            }
        }

        // Delete video function - moved to top for hoisting
        async function deleteVideo(videoId) {
            if (!confirm('Bu videoyu silmek istediƒüinizden emin misiniz?')) {
                return;
            }

            try {
                console.log('üóëÔ∏è Video siliniyor:', videoId);
                
                const result = await window.DB.delete('coordinatorVideos', videoId);
                if (result && result.success) {
                    console.log('‚úÖ Video ba≈üarƒ±yla silindi');
                    
                    // Reload videos and update stats
                    await loadVideos();
                    await updateStats();
                    
                    alert('Video ba≈üarƒ±yla silindi!');
                } else {
                    throw new Error('Video silinemedi');
                }
                
            } catch (error) {
                console.error('‚ùå Video silme hatasƒ±:', error);
                alert('Video silinirken hata olu≈ütu: ' + error.message);
            }
        }

        // Edit video function - moved to top for hoisting
        async function editVideo(videoId) {
            try {
                const video = await window.DB.load('coordinatorVideos', videoId);
                if (!video) {
                    alert('Video bulunamadƒ±!');
                    return;
                }
                
                // Fill form with existing data
                document.getElementById('videoTitle').value = video.title;
                document.getElementById('videoModule').value = video.moduleId;
                document.getElementById('youtubeUrl').value = video.youtubeUrl;
                document.getElementById('videoDescription').value = video.description || '';
                document.getElementById('videoDuration').value = video.duration;
                
                const difficultySelect = document.getElementById('difficulty-level');
                if (difficultySelect) {
                    difficultySelect.value = video.difficulty || 'intermediate';
                }
                
                // Set editing mode
                editingVideoId = videoId;
                
                // Update form button
                const submitButton = document.querySelector('#videoForm button[type="submit"]');
                if (submitButton) {
                    submitButton.innerHTML = '<i class="fas fa-save mr-2"></i>Deƒüi≈üiklikleri Kaydet';
                    submitButton.className = 'bg-secondary text-white px-6 py-3 rounded-lg hover:bg-secondary/90';
                }
                
                alert(`"${video.title}" videosu d√ºzenleme moduna alƒ±ndƒ±.`);
                
            } catch (error) {
                console.error('‚ùå Video d√ºzenleme hatasƒ±:', error);
                alert('‚ùå Video d√ºzenleme moduna ge√ßerken hata olu≈ütu: ' + error.message);
            }
        }

        // Generate AI questions for video - moved to top for hoisting
        async function generateAIQuestionsForVideo(videoId, videoTitle) {
            try {
                console.log('ü§ñ AI soru √ºretimi ba≈ülatƒ±lƒ±yor:', videoId, videoTitle);
                
                const api = window.GroqAPI || window.GeminiAPI;
                if (!api) {
                    alert('AI soru √ºretimi i√ßin Groq API gerekli!');
                    return;
                }
                
                const questions = await api.generateQuizQuestion(videoTitle, 'orta');
                if (questions && questions.length > 0) {
                    // Add questions to video
                    const video = await window.DB.load('coordinatorVideos', videoId);
                    if (video) {
                        video.questions = (video.questions || []).concat(questions);
                        await window.DB.save('coordinatorVideos', video, videoId);
                        
                        alert(`${questions.length} AI sorusu "${videoTitle}" videosuna eklendi!`);
                        await loadVideos();
                    }
                } else {
                    alert('AI soru √ºretimi ba≈üarƒ±sƒ±z oldu.');
                }
                
            } catch (error) {
                console.error('‚ùå AI soru √ºretimi hatasƒ±:', error);
                alert('AI soru √ºretimi sƒ±rasƒ±nda hata olu≈ütu: ' + error.message);
            }
        }

        // Add manual questions to video - moved to top for hoisting
        async function addManualQuestionsToVideo(videoId, videoTitle) {
            try {
                console.log('‚úèÔ∏è Manuel soru ekleme ba≈ülatƒ±lƒ±yor:', videoId, videoTitle);
                
                currentVideoId = videoId;
                questionCount = 0;
                
                // Show manual questions modal or form
                const questionsContainer = document.getElementById('manual-questions-container');
                if (questionsContainer) {
                    questionsContainer.innerHTML = '';
                    addNewManualQuestion();
                    
                    // Show the questions section
                    const questionsSection = document.getElementById('questions-section');
                    if (questionsSection) {
                        questionsSection.style.display = 'block';
                    }
                }
                
                alert(`"${videoTitle}" videosuna manuel soru ekleme moduna ge√ßildi.`);
                
            } catch (error) {
                console.error('‚ùå Manuel soru ekleme hatasƒ±:', error);
                alert('Manuel soru ekleme sƒ±rasƒ±nda hata olu≈ütu: ' + error.message);
            }
        }

        // Logout function - moved to top for hoisting
        function logout() {
            if (confirm('√áƒ±kƒ±≈ü yapmak istediƒüinizden emin misiniz?')) {
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('userEmail');
                localStorage.removeItem('loginTime');
                localStorage.removeItem('userRole');
                
                console.log('üö™ Koordinat√∂r √ßƒ±kƒ±≈üƒ± yapƒ±ldƒ±');
                window.location.href = 'index.html';
            }
        }

        // Add new video question - moved to top for hoisting
        function addNewVideoQuestion(questionType = 'multiple-choice') {
            const container = document.getElementById('video-questions-container');
            const questionNumber = container.children.length + 1;
            
            const questionDiv = document.createElement('div');
            questionDiv.className = 'bg-white p-4 rounded-lg border-2 border-gray-300';
            questionDiv.dataset.questionType = questionType;
            
            let questionHTML = `
                <div class="flex justify-between items-center mb-3">
                    <div class="flex items-center gap-2">
                        <h4 class="font-medium text-gray-900">Soru ${questionNumber}</h4>
                        <span class="px-2 py-1 text-xs rounded-full ${
                            questionType === 'multiple-choice' ? 'bg-blue-100 text-blue-800' :
                            questionType === 'open-ended' ? 'bg-green-100 text-green-800' :
                            'bg-orange-100 text-orange-800'
                        }">
                            ${questionType === 'multiple-choice' ? '√áoktan Se√ßmeli' :
                              questionType === 'open-ended' ? 'A√ßƒ±k U√ßlu' :
                              'Bo≈üluk Doldurma'}
                        </span>
                    </div>
                    <button type="button" onclick="this.closest('.bg-white').remove()" class="text-red-600 hover:text-red-800">
                        <i class="fas fa-times"></i> Sil
                    </button>
                </div>
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Soru Metni</label>
                        <textarea class="question-text w-full p-2 border border-gray-300 rounded-lg" rows="2" placeholder="${
                            questionType === 'fill-blank' ? 'Bo≈üluklarƒ± ___ ile belirtin. √ñrn: Kriptoloji ___ bilimi olarak tanƒ±mlanƒ±r.' : 'Sorunuzu yazƒ±n...'
                        }" required></textarea>
                    </div>
            `;
            
            if (questionType === 'multiple-choice') {
                questionHTML += `
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">A) Se√ßenek</label>
                            <input type="text" class="option-a w-full p-2 border border-gray-300 rounded-lg" placeholder="A se√ßeneƒüi" required>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">B) Se√ßenek</label>
                            <input type="text" class="option-b w-full p-2 border border-gray-300 rounded-lg" placeholder="B se√ßeneƒüi" required>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">C) Se√ßenek</label>
                            <input type="text" class="option-c w-full p-2 border border-gray-300 rounded-lg" placeholder="C se√ßeneƒüi" required>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">D) Se√ßenek</label>
                            <input type="text" class="option-d w-full p-2 border border-gray-300 rounded-lg" placeholder="D se√ßeneƒüi" required>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Doƒüru Cevap</label>
                            <select class="correct-answer w-full p-2 border border-gray-300 rounded-lg" required>
                                <option value="">Se√ßin</option>
                                <option value="0">A</option>
                                <option value="1">B</option>
                                <option value="2">C</option>
                                <option value="3">D</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Zorluk</label>
                            <select class="question-difficulty w-full p-2 border border-gray-300 rounded-lg">
                                <option value="easy">Kolay</option>
                                <option value="medium" selected>Orta</option>
                                <option value="hard">Zor</option>
                            </select>
                        </div>
                    </div>
                `;
            } else if (questionType === 'open-ended') {
                questionHTML += `
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">√ñrnek Cevap Anahtar Kelimeleri (virg√ºlle ayƒ±rƒ±n)</label>
                        <input type="text" class="answer-keywords w-full p-2 border border-gray-300 rounded-lg" 
                               placeholder="√ñrn: ≈üifreleme, g√ºvenlik, anahtar" required>
                        <p class="text-xs text-gray-500 mt-1">AI bu anahtar kelimeleri kullanarak cevaplarƒ± deƒüerlendirecek</p>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Zorluk</label>
                        <select class="question-difficulty w-full p-2 border border-gray-300 rounded-lg">
                            <option value="easy">Kolay</option>
                            <option value="medium" selected>Orta</option>
                            <option value="hard">Zor</option>
                        </select>
                    </div>
                `;
            } else if (questionType === 'fill-blank') {
                questionHTML += `
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Doƒüru Cevaplar (virg√ºlle ayƒ±rƒ±n, bo≈üluk sƒ±rasƒ±na g√∂re)</label>
                        <input type="text" class="fill-blank-answers w-full p-2 border border-gray-300 rounded-lg" 
                               placeholder="√ñrn: ≈üifreleme, kriptoloji" required>
                        <p class="text-xs text-gray-500 mt-1">Her bo≈üluk i√ßin doƒüru cevabƒ± yazƒ±n</p>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Zorluk</label>
                        <select class="question-difficulty w-full p-2 border border-gray-300 rounded-lg">
                            <option value="easy">Kolay</option>
                            <option value="medium" selected>Orta</option>
                            <option value="hard">Zor</option>
                        </select>
                    </div>
                `;
            }
            
            questionHTML += `
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">A√ßƒ±klama (Opsiyonel)</label>
                        <textarea class="question-explanation w-full p-2 border border-gray-300 rounded-lg" rows="2" placeholder="Cevabƒ±n a√ßƒ±klamasƒ±..."></textarea>
                    </div>
                </div>
            `;
            
            questionDiv.innerHTML = questionHTML;
            container.appendChild(questionDiv);
            console.log(`‚úÖ ${questionType} tipi soru ${questionNumber} eklendi`);
        }

        // Reset video form - moved to top for hoisting
        function resetVideoForm() {
            if (confirm('Formu temizlemek istediƒüinizden emin misiniz? T√ºm girilen bilgiler silinecek.')) {
                document.getElementById('videoForm').reset();
                document.getElementById('video-questions-container').innerHTML = '';
                console.log('üîÑ Form temizlendi');
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üìÑ Instructor Content sayfasƒ± y√ºkleniyor...');
            console.log('Firebase DB mevcut:', window.DB ? 'YES' : 'NO');
            
            // Wait for Firebase DB to be available
            if (!window.DB) {
                console.log('‚è≥ Firebase DB bekleniyor...');
                let waitAttempts = 0;
                while (!window.DB && waitAttempts < 10) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                    waitAttempts++;
                    console.log(`‚è≥ Firebase DB bekleme denemesi: ${waitAttempts}/10`);
                }
                
                if (!window.DB) {
                    console.error('‚ùå Firebase DB sistemi 5 saniye i√ßinde y√ºklenmedi!');
                    return;
                }
            }
            
            // Wait for Firebase to be ready
            if (!window.DB.isFirebaseReady) {
                console.log('‚è≥ Firebase hazƒ±r olmasƒ± bekleniyor...');
                let readyAttempts = 0;
                while (!window.DB.isFirebaseReady && readyAttempts < 10) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                    readyAttempts++;
                    console.log(`‚è≥ Firebase ready bekleme denemesi: ${readyAttempts}/10`);
                }
                
                if (!window.DB.isFirebaseReady) {
                    console.error('‚ùå Firebase 5 saniye i√ßinde hazƒ±r olmadƒ±!');
                    return;
                }
            }
            
            console.log('‚úÖ Firebase hazƒ±r, coordinator content y√ºkleniyor...');
            
            // Initialize user info using UserUtils
            await UserUtils.initializeUserInfo();
            
            // Update coordinator-specific display names
            const userEmail = localStorage.getItem('userEmail');
            if (userEmail) {
                const userName = userEmail.split('@')[0];
                const displayName = 'Koordinat√∂r ' + userName.charAt(0).toUpperCase() + userName.slice(1);
                
                // Desktop sidebar g√ºncelle
                const instructorNameEl = document.getElementById('instructor-name');
                const instructorEmailEl = document.getElementById('instructor-email');
                
                if (instructorNameEl) instructorNameEl.textContent = displayName;
                if (instructorEmailEl) instructorEmailEl.textContent = '';
            }
            
            // Wait for Firebase Production DB to initialize
            await new Promise(resolve => {
                const checkDB = () => {
                    if (window.DB) {
                        console.log('‚úÖ Firebase Production DB hazƒ±r!');
                        resolve();
                    } else {
                        console.log('‚è≥ Firebase Production DB bekleniyor...');
                        setTimeout(checkDB, 200);
                    }
                };
                checkDB();
            });
            
            await loadVideos();
            await loadModules(); // Load modules for dropdown
            setupEventListeners();
            setupMobileMenu();
            
            console.log('‚úÖ Instructor Content sayfasƒ± hazƒ±r!');
        });

        function setupEventListeners() {
            // Video form submission
            const videoForm = document.getElementById('videoForm');
            if (videoForm) {
                videoForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log('üìù Form submit edildi');
                    addVideo();
                });
            }

            // AI Questions button
            const generateAIBtn = document.getElementById('generateAIQuestions');
            if (generateAIBtn) {
                generateAIBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    generateAIQuestions('new-video');
                });
            }

            // Manual Question button
            const addManualBtn = document.getElementById('addManualQuestion');
            if (addManualBtn) {
                addManualBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    showManualQuestionSection();
                });
            }

            // Skip Questions button
            const skipQuestionsBtn = document.getElementById('skipQuestions');
            if (skipQuestionsBtn) {
                skipQuestionsBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    skipQuestions();
                });
            }

            // Filter videos
            const filterModule = document.getElementById('filterModule');
            if (filterModule) {
                filterModule.addEventListener('change', function() {
                    filterVideos();
                });
            }

            // Logout function
            function logout() {
                if (confirm('√áƒ±kƒ±≈ü yapmak istediƒüinizden emin misiniz?')) {
                    localStorage.removeItem('isLoggedIn');
                    localStorage.removeItem('userEmail');
                    localStorage.removeItem('loginTime');
                    localStorage.removeItem('userRole');
                    
                    console.log('üö™ Koordinat√∂r √ßƒ±kƒ±≈üƒ± yapƒ±ldƒ±');
                    window.location.href = 'index.html';
                }
            }
        }

        // Show manual question section
        function showManualQuestionSection() {
            const section = document.getElementById('manual-questions-section');
            if (section) {
                section.style.display = 'block';
                
                // Update section title for new video
                const sectionTitle = section.querySelector('h2');
                if (sectionTitle) {
                    sectionTitle.innerHTML = `
                        <i class="fas fa-edit text-primary mr-2"></i>
                        Yeni Video i√ßin Manuel Soru Olu≈üturma
                    `;
                }
            }
            
            // Clear existing questions and add first question if none exists
            const container = document.getElementById('manual-questions-container');
            if (container && container.children.length === 0) {
                addNewManualQuestion();
            }
            
            // Scroll to the section
            if (section) {
                section.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Add new manual question form
        function addNewManualQuestion() {
            const container = document.getElementById('manual-questions-container');
            const questionCount = container.children.length + 1;
            
            const questionDiv = document.createElement('div');
            questionDiv.className = 'border border-gray-200 rounded-lg p-6 bg-gray-50';
            questionDiv.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-gray-900">Soru ${questionCount}</h3>
                    <button type="button" onclick="removeManualQuestion(this)" class="text-red-600 hover:text-red-800 text-sm">
                        <i class="fas fa-trash mr-1"></i> Sil
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Soru Metni</label>
                        <textarea class="question-text w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" 
                                  rows="3" placeholder="Sorunuzu buraya yazƒ±n..." required></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">A Se√ßeneƒüi</label>
                            <input type="text" class="option-a w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" 
                                   placeholder="A se√ßeneƒüi" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">B Se√ßeneƒüi</label>
                            <input type="text" class="option-b w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" 
                                   placeholder="B se√ßeneƒüi" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">C Se√ßeneƒüi</label>
                            <input type="text" class="option-c w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" 
                                   placeholder="C se√ßeneƒüi" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">D Se√ßeneƒüi</label>
                            <input type="text" class="option-d w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" 
                                   placeholder="D se√ßeneƒüi" required>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Doƒüru Cevap</label>
                            <select class="correct-answer w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                <option value="">Doƒüru cevabƒ± se√ßin</option>
                                <option value="0">A</option>
                                <option value="1">B</option>
                                <option value="2">C</option>
                                <option value="3">D</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Zorluk Seviyesi</label>
                            <select class="question-difficulty w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="easy">Kolay</option>
                                <option value="medium" selected>Orta</option>
                                <option value="hard">Zor</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">A√ßƒ±klama (ƒ∞steƒüe baƒülƒ±)</label>
                        <textarea class="question-explanation w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" 
                                  rows="2" placeholder="Doƒüru cevabƒ±n a√ßƒ±klamasƒ±..."></textarea>
                    </div>
                </div>
            `;
            
            container.appendChild(questionDiv);
        }

        // Remove manual question
        function removeManualQuestion(button) {
            const questionDiv = button.closest('.border');
            questionDiv.remove();
            
            // Update question numbers
            const container = document.getElementById('manual-questions-container');
            const questions = container.children;
            for (let i = 0; i < questions.length; i++) {
                const title = questions[i].querySelector('h3');
                title.textContent = `Soru ${i + 1}`;
            }
        }

        // Save manual questions
        async function saveManualQuestions() {
            try {
                console.log('üîß Manuel soru kaydetme ba≈üladƒ±...');
                console.log('Current Video ID:', currentVideoId);
                
                if (!currentVideoId) {
                    alert('‚ùå √ñnce bir video se√ßin!');
                    return;
                }

                const questions = [];
                const questionDivs = document.querySelectorAll('#manual-questions-container .border');
                
                console.log('Bulunan soru div sayƒ±sƒ±:', questionDivs.length);
                
                if (questionDivs.length === 0) {
                    alert('‚ùå Hi√ß soru eklenmemi≈ü!');
                    return;
                }

                // Process each question
                let hasErrors = false;
                questionDivs.forEach((div, index) => {
                    console.log(`üîç Soru ${index + 1} i≈üleniyor...`);
                    
                    const questionText = div.querySelector('.question-text')?.value?.trim();
                    const optionA = div.querySelector('.option-a')?.value?.trim();
                    const optionB = div.querySelector('.option-b')?.value?.trim();
                    const optionC = div.querySelector('.option-c')?.value?.trim();
                    const optionD = div.querySelector('.option-d')?.value?.trim();
                    const correctAnswerElement = div.querySelector('.correct-answer');
                    const correctAnswer = correctAnswerElement ? parseInt(correctAnswerElement.value) : NaN;
                    const difficulty = div.querySelector('.question-difficulty')?.value;
                    const explanation = div.querySelector('.question-explanation')?.value?.trim();

                    console.log('Soru verileri:', {
                        questionText,
                        optionA,
                        optionB,
                        optionC,
                        optionD,
                        correctAnswer,
                        difficulty,
                        explanation
                    });

                    // Skip empty questions instead of showing error
                    if (!questionText && !optionA && !optionB && !optionC && !optionD) {
                        console.log(`‚è≠Ô∏è Soru ${index + 1}: Bo≈ü soru atlanƒ±yor`);
                        return; // Skip this empty question
                    }

                    // Check if question is partially filled
                    if (!questionText || !optionA || !optionB || !optionC || !optionD || isNaN(correctAnswer)) {
                        console.error(`‚ùå Soru ${index + 1}: Eksik veri tespit edildi`);
                        hasErrors = true;
                        return;
                    }

                    questions.push({
                        question: questionText,
                        options: [optionA, optionB, optionC, optionD],
                        correct: correctAnswer,
                        difficulty: difficulty,
                        explanation: explanation,
                        type: 'manual',
                        createdAt: new Date().toISOString()
                    });
                    
                    console.log(`‚úÖ Soru ${index + 1} ba≈üarƒ±yla eklendi`);
                });

                // Show error message if there are partially filled questions
                if (hasErrors) {
                    alert('‚ùå Bazƒ± sorular eksik bilgi i√ßeriyor. L√ºtfen t√ºm alanlarƒ± doldurun veya bo≈ü sorularƒ± silin.');
                    return;
                }

                console.log('Toplam i≈ülenecek soru sayƒ±sƒ±:', questions.length);

                if (questions.length === 0) {
                    alert('‚ùå Ge√ßerli soru bulunamadƒ±!');
                    return;
                }

                console.log('üìπ Video y√ºkleniyor, ID:', currentVideoId);

                // Load existing video and add questions
                const videoResult = await window.DB.load('coordinatorVideos', currentVideoId);
                const video = (videoResult && videoResult.success) ? videoResult.data : null;
                
                console.log('Video y√ºkleme sonucu:', videoResult);
                console.log('Video verisi:', video);
                
                if (!video) {
                    alert('‚ùå Video bulunamadƒ±!');
                    return;
                }

                // Add questions to existing video
                if (!video.questions) {
                    video.questions = [];
                }
                
                const oldQuestionCount = video.questions.length;
                video.questions.push(...questions);
                video.updatedAt = new Date().toISOString();

                console.log('üìù Video kaydediliyor...');
                console.log('Eski soru sayƒ±sƒ±:', oldQuestionCount);
                console.log('Yeni soru sayƒ±sƒ±:', video.questions.length);

                // Save updated video
                const success = await window.DB.save('coordinatorVideos', video, currentVideoId);
                
                console.log('Kaydetme sonucu:', success);
                
                if (success && success.success) {
                    console.log('‚úÖ Sorular ba≈üarƒ±yla kaydedildi');
                    
                    // Sync to student dashboard
                    console.log('üîÑ Senkronizasyon ba≈ülatƒ±lƒ±yor...');
                    await window.DB.syncCoordinatorVideos();
                    
                    alert(`‚úÖ ${questions.length} soru "${video.title}" videosuna ba≈üarƒ±yla eklendi!\n\n√ñnceki soru sayƒ±sƒ±: ${oldQuestionCount}\nYeni soru sayƒ±sƒ±: ${video.questions.length}`);
                    
                    // Hide section and clear
                    cancelManualQuestions();
                    currentVideoId = null;
                    
                    // Reload videos to show updated count
                    await loadVideos();
                } else {
                    throw new Error('Sorular kaydedilemedi: ' + JSON.stringify(success));
                }

            } catch (error) {
                console.error('‚ùå Manuel soru kaydetme hatasƒ±:', error);
                console.error('Hata detaylarƒ±:', error.stack);
                alert('‚ùå Sorular kaydedilirken hata olu≈ütu: ' + error.message);
            }
        }

        // Cancel manual questions
        function cancelManualQuestions() {
            const section = document.getElementById('manual-questions-section');
            if (section) {
                section.style.display = 'none';
                
                // Reset section title
                const sectionTitle = section.querySelector('h2');
                if (sectionTitle) {
                    sectionTitle.innerHTML = `
                        <i class="fas fa-edit text-primary mr-2"></i>
                        Manuel Soru Olu≈üturma
                    `;
                }
            }
            
            // Clear all questions
            const container = document.getElementById('manual-questions-container');
            if (container) {
                container.innerHTML = '';
            }
            
            // Reset current video
            currentVideoId = null;
        }

        function setupMobileMenu() {
            // Mobile menu toggle
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileSidebar = document.getElementById('mobile-sidebar-overlay');
            const closeMobileMenu = document.getElementById('close-mobile-menu');
            
            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', function() {
                    mobileSidebar.classList.toggle('hidden');
                    document.body.classList.toggle('overflow-hidden');
                });
            }
            
            if (closeMobileMenu) {
                closeMobileMenu.addEventListener('click', function() {
                    mobileSidebar.classList.add('hidden');
                    document.body.classList.remove('overflow-hidden');
                });
            }
        }

        async function addVideo() {
            console.log('üé¨ Video ekleme ba≈üladƒ±...');
            
            const title = document.getElementById('videoTitle').value;
            const moduleId = document.getElementById('videoModule').value;
            const youtubeUrl = document.getElementById('youtubeUrl').value;
            const description = document.getElementById('videoDescription').value;
            const duration = document.getElementById('videoDuration').value;
            const difficulty = document.getElementById('difficulty-level').value;

            console.log('üìã Form verileri:', { title, moduleId, youtubeUrl, description, duration, difficulty });

            // Validate required fields
            if (!title || !moduleId || !youtubeUrl) {
                alert('‚ùå L√ºtfen t√ºm gerekli alanlarƒ± doldurun!');
                return;
            }

            // Validate YouTube URL
            if (!isValidYouTubeUrl(youtubeUrl)) {
                alert('‚ùå Ge√ßerli bir YouTube URL\'si girin!');
                return;
            }

            // Extract video ID from YouTube URL
            const videoId = extractYouTubeVideoId(youtubeUrl);
            if (!videoId) {
                alert('‚ùå YouTube video ID\'si √ßƒ±karƒ±lamadƒ±!');
                return;
            }

            console.log('üé• YouTube Video ID:', videoId);
            
            try {
                if (editingVideoId) {
                    console.log('‚úèÔ∏è Video g√ºncelleniyor:', editingVideoId);
                    
                    // Update existing video
                    const existingVideoResult = await window.DB.load('coordinatorVideos', editingVideoId);
                    const existingVideo = (existingVideoResult && existingVideoResult.success) ? existingVideoResult.data : null;
                    
                    if (!existingVideo) {
                        alert('‚ùå G√ºncellenecek video bulunamadƒ±!');
                        return;
                    }
                    
                    const videoData = {
                        ...existingVideo,
                        title: title,
                        moduleId: moduleId,
                        youtubeUrl: youtubeUrl,
                        youtubeVideoId: videoId,
                        description: description,
                        duration: duration,
                        difficulty: difficulty,
                        updatedAt: new Date().toISOString()
                    };
                    
                    const success = await window.DB.save('coordinatorVideos', videoData, editingVideoId);
                    if (success && success.success) {
                        console.log('‚úÖ Video g√ºncellendi:', editingVideoId);
                        await window.DB.syncCoordinatorVideos();
                        alert(`‚úÖ "${title}" videosu ba≈üarƒ±yla g√ºncellendi!`);
                        resetVideoForm();
                    } else {
                        throw new Error('Video g√ºncelleme ba≈üarƒ±sƒ±z');
                    }
                } else {
                    console.log('‚ûï Yeni video ekleniyor...');
                    
                    // Collect questions from form - support multiple question types
                    const questions = [];
                    const questionDivs = document.querySelectorAll('#video-questions-container .bg-white');
                    
                    questionDivs.forEach((div, index) => {
                        const questionType = div.dataset.questionType || 'multiple-choice';
                        const questionText = div.querySelector('.question-text')?.value?.trim();
                        const questionDifficulty = div.querySelector('.question-difficulty')?.value || 'medium';
                        const explanation = div.querySelector('.question-explanation')?.value?.trim();
                        
                        if (!questionText) return;
                        
                        const questionData = {
                            type: questionType,
                            question: questionText,
                            difficulty: questionDifficulty,
                            explanation: explanation || ''
                        };
                        
                        if (questionType === 'multiple-choice') {
                            const optionA = div.querySelector('.option-a')?.value?.trim();
                            const optionB = div.querySelector('.option-b')?.value?.trim();
                            const optionC = div.querySelector('.option-c')?.value?.trim();
                            const optionD = div.querySelector('.option-d')?.value?.trim();
                            const correctAnswer = div.querySelector('.correct-answer')?.value;
                            
                            if (optionA && optionB && optionC && optionD && correctAnswer !== '') {
                                questionData.options = [optionA, optionB, optionC, optionD];
                                questionData.correctAnswer = parseInt(correctAnswer);
                                questions.push(questionData);
                                console.log(`‚úÖ √áoktan se√ßmeli soru ${index + 1} eklendi`);
                            }
                        } else if (questionType === 'open-ended') {
                            const keywords = div.querySelector('.answer-keywords')?.value?.trim();
                            if (keywords) {
                                questionData.keywords = keywords.split(',').map(k => k.trim());
                                questions.push(questionData);
                                console.log(`‚úÖ A√ßƒ±k u√ßlu soru ${index + 1} eklendi`);
                            }
                        } else if (questionType === 'fill-blank') {
                            const answers = div.querySelector('.fill-blank-answers')?.value?.trim();
                            if (answers) {
                                questionData.correctAnswers = answers.split(',').map(a => a.trim());
                                questions.push(questionData);
                                console.log(`‚úÖ Bo≈üluk doldurma soru ${index + 1} eklendi`);
                            }
                        }
                    });
                    
                    console.log(`üìù Toplam ${questions.length} soru eklendi`);
                    
                    // Create new video - with questions
                    const videoData = {
                        title: title,
                        moduleId: moduleId,
                        youtubeUrl: youtubeUrl,
                        youtubeVideoId: videoId,
                        description: description,
                        duration: duration,
                        difficulty: difficulty,
                        questions: questions,
                        createdAt: new Date().toISOString()
                    };

                    const success = await window.DB.save('coordinatorVideos', videoData);
                    if (success && success.success) {
                        console.log('‚úÖ Yeni video eklendi');
                        
                        // Sync to student dashboard immediately
                        await window.DB.syncCoordinatorVideos();
                        console.log('‚úÖ Video senkronizasyonu tamamlandƒ±');
                        
                        // Store the new video ID for question addition
                        currentVideoId = success.id;
                        
                        alert(`‚úÖ "${title}" videosu ba≈üarƒ±yla eklendi!\n\nVideo ID: ${success.id || 'Otomatik'}\nMod√ºl: ${moduleId}`);
                        
                        // Reset form after successful addition
                        resetVideoForm();
                        
                        // Reload videos to show the new video
                        await loadVideos();
                        
                        // Update stats
                        updateStats();
                    } else {
                        throw new Error('Video ekleme ba≈üarƒ±sƒ±z');
                    }
                }
                
            } catch (error) {
                console.error('‚ùå Video ekleme/g√ºncelleme hatasƒ±:', error);
                alert('‚ùå Video i≈üleminde hata olu≈ütu: ' + error.message);
            }
        }

        function resetVideoForm() {
            // Reset form
            const form = document.getElementById('videoForm');
            if (form) {
                form.reset();
            }
            
            // Reset editing state
            editingVideoId = null;
            currentVideoId = null;
            
            // Reset questions
            currentVideoQuestions = [];
            
            // Clear video questions container
            const videoQuestionsContainer = document.getElementById('video-questions-container');
            if (videoQuestionsContainer) {
                videoQuestionsContainer.innerHTML = '';
            }
            
            // Hide manual question section
            const section = document.getElementById('manual-questions-section');
            if (section) {
                section.style.display = 'none';
            }
            const container = document.getElementById('manual-questions-container');
            if (container) {
                container.innerHTML = '';
            }
            
            // Reset form button
            const submitButton = document.querySelector('#videoForm button[type="submit"]');
            if (submitButton) {
                submitButton.innerHTML = '<i class="fas fa-upload mr-2"></i>Video Y√ºkle';
                submitButton.className = 'bg-cyber text-white px-6 py-3 rounded-lg hover:bg-cyber/90';
            }
            
            console.log('‚úÖ Video formu sƒ±fƒ±rlandƒ±');
        }

        function addQuestion(containerType) {
            questionCount++;
            
            const containerId = containerType === 'new-video' ? 'new-video-questions-container' : 'existing-video-questions-container';
            const questionsContainer = document.getElementById(containerId);
            
            if (!questionsContainer) {
                alert('HATA: Questions container bulunamadƒ±!');
                return;
            }
            
            const questionDiv = document.createElement('div');
            questionDiv.className = 'border border-gray-200 rounded-lg p-4 mb-4';
            questionDiv.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h4 class="font-medium text-gray-900">Soru ${questionCount}</h4>
                    <button type="button" onclick="removeQuestion(this)" class="text-red-600 hover:text-red-800">
                        ‚úï Sil
                    </button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Soru Metni</label>
                        <textarea class="w-full p-3 border border-gray-300 rounded-lg" rows="3" placeholder="Sorunuzu yazƒ±n..."></textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">A Se√ßeneƒüi</label>
                            <input type="text" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="A se√ßeneƒüi">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">B Se√ßeneƒüi</label>
                            <input type="text" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="B se√ßeneƒüi">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">C Se√ßeneƒüi</label>
                            <input type="text" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="C se√ßeneƒüi">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">D Se√ßeneƒüi</label>
                            <input type="text" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="D se√ßeneƒüi">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Doƒüru Cevap</label>
                        <select class="w-full p-3 border border-gray-300 rounded-lg">
                            <option value="0">A</option>
                            <option value="1">B</option>
                            <option value="2">C</option>
                            <option value="3">D</option>
                        </select>
                    </div>
                </div>
            `;
            
            questionsContainer.appendChild(questionDiv);
            console.log(`‚úÖ Soru ${questionCount} formu eklendi`);
        }

        function removeQuestion(button) {
            button.closest('.border').remove();
        }

        async function saveQuestions(containerType) {
            if (!currentVideoId) {
                alert('HATA: √ñnce bir video se√ßmelisiniz!');
                return;
            }

            const questions = [];
            const containerId = containerType === 'new-video' ? 'new-video-questions-container' : 'existing-video-questions-container';
            const questionDivs = document.querySelectorAll(`#${containerId} .border`);
            
            if (questionDivs.length === 0) {
                alert('HATA: Hi√ß soru eklenmemi≈ü! √ñnce "Yeni Soru Ekle" butonuna tƒ±klayƒ±n.');
                return;
            }

            // Process each question
            questionDivs.forEach((div, index) => {
                const textarea = div.querySelector('textarea');
                const textInputs = div.querySelectorAll('input[type="text"]');
                const selectElement = div.querySelector('select');

                if (!textarea || textInputs.length < 4 || !selectElement) {
                    return;
                }

                const questionText = textarea.value ? textarea.value.trim() : '';
                const optionA = textInputs[0] && textInputs[0].value ? textInputs[0].value.trim() : '';
                const optionB = textInputs[1] && textInputs[1].value ? textInputs[1].value.trim() : '';
                const optionC = textInputs[2] && textInputs[2].value ? textInputs[2].value.trim() : '';
                const optionD = textInputs[3] && textInputs[3].value ? textInputs[3].value.trim() : '';
                const correctAnswer = selectElement.value ? parseInt(selectElement.value) : NaN;

                if (!questionText || !optionA || !optionB || !optionC || !optionD || isNaN(correctAnswer)) {
                    alert(`Soru ${index + 1}: T√ºm alanlarƒ± doldurun ve doƒüru cevabƒ± se√ßin!`);
                    return;
                }

                questions.push({
                    question: questionText,
                    options: [optionA, optionB, optionC, optionD],
                    correct: correctAnswer
                });
            });

            if (questions.length === 0) {
                alert('Hi√ß ge√ßerli soru bulunamadƒ±! L√ºtfen t√ºm alanlarƒ± doldurun.');
                return;
            }

            try {
                // Save questions to video
                const videoResult = await window.DB.load('coordinatorVideos', currentVideoId);
                const video = (videoResult && videoResult.success) ? videoResult.data : null;
                
                if (!video) {
                    alert('HATA: Video bulunamadƒ±! ID: ' + currentVideoId);
                    console.error('Video bulunamadƒ±:', currentVideoId);
                    return;
                }

                // Add questions to video
                if (!video.questions) {
                    video.questions = [];
                }
                
                const oldQuestionCount = video.questions.length;
                video.questions.push(...questions);
                const newQuestionCount = video.questions.length;

                // Save updated video
                const success = await window.DB.save('coordinatorVideos', video, currentVideoId);
                
                if (success && success.success) {
                    console.log('‚úÖ Sorular kaydedildi:', questions.length);
                    console.log('üìä Toplam soru sayƒ±sƒ±:', newQuestionCount);
                    
                    // Sync to student dashboard
                    await window.DB.syncCoordinatorVideos();
                    
                    alert(`‚úÖ ${questions.length} soru ba≈üarƒ±yla eklendi!\n\nToplam soru sayƒ±sƒ±: ${newQuestionCount}`);
                    
                    // Hide forms and clear
                    if (containerType === 'new-video') {
                        document.getElementById('questions-section').style.display = 'none';
                        document.getElementById('new-video-questions-container').innerHTML = '';
                    } else {
                        document.getElementById('question-form').style.display = 'none';
                        document.getElementById('video-form').style.display = 'block';
                        document.getElementById('existing-video-questions-container').innerHTML = '';
                    }
                    
                    questionCount = 0;
                    currentVideoId = null;
                    
                    // Reload videos to show updated count
                    await loadVideos();
                } else {
                    throw new Error('Soru kaydetme ba≈üarƒ±sƒ±z');
                }
                
            } catch (error) {
                console.error('‚ùå Soru kaydetme hatasƒ±:', error);
                alert('‚ùå Sorular kaydedilirken hata olu≈ütu: ' + error.message);
            }
        }

        async function loadVideos() {
            try {
                console.log('üìö Videolar y√ºkleniyor...');
                const videosResult = await window.DB.load('coordinatorVideos');
                const videos = (videosResult && videosResult.success) ? videosResult.data : [];
                const videosList = document.getElementById('videos-container');
                
                console.log('üìπ Bulunan video sayƒ±sƒ±:', videos.length);
                
                if (videos.length === 0) {
                    videosList.innerHTML = '<p class="text-gray-500 text-center py-8">Hen√ºz video eklenmemi≈ü. Yukarƒ±daki formu kullanarak ilk videonuzu ekleyin.</p>';
                    return;
                }

                videosList.innerHTML = videos.map(video => `
                    <div class="border border-gray-200 rounded-lg p-4">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-2">
                                    <h4 class="font-medium text-gray-900">${video.title}</h4>
                                    <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">Mod√ºl ${video.moduleId}</span>
                                    <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">${video.questions ? video.questions.length : 0} Soru</span>
                                    <span class="px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full">üî• Firebase</span>
                                </div>
                                <p class="text-sm text-gray-600 mb-2">${video.description || 'A√ßƒ±klama yok'}</p>
                                <div class="flex items-center space-x-4 text-xs text-gray-500">
                                    <span><i class="fas fa-clock mr-1"></i>${video.duration} dk</span>
                                    <span><i class="fas fa-signal mr-1"></i>${video.difficulty}</span>
                                    <span><i class="fas fa-calendar mr-1"></i>${video.createdAt ? new Date(video.createdAt).toLocaleDateString('tr-TR') : 'Tarih yok'}</span>
                                </div>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <a href="${video.youtubeUrl}" target="_blank" class="bg-red-600 text-white px-3 py-1 rounded text-xs hover:bg-red-700">
                                    <i class="fab fa-youtube mr-1"></i>YouTube
                                </a>
                                <button onclick="addManualQuestionsToVideo('${video.id}', '${video.title.replace(/'/g, '\\\'')}')" class="bg-primary text-white px-3 py-1 rounded text-xs hover:bg-primary/90">
                                    <i class="fas fa-plus mr-1"></i>Manuel Soru
                                </button>
                                <button onclick="editVideo('${video.id}')" class="bg-secondary text-white px-3 py-1 rounded text-xs hover:bg-secondary/90">
                                    <i class="fas fa-edit mr-1"></i>D√ºzenle
                                </button>
                                <button onclick="deleteVideo('${video.id}')" class="bg-red-600 text-white px-3 py-1 rounded text-xs hover:bg-red-700">
                                    <i class="fas fa-trash mr-1"></i>Sil
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');

                // Update stats
                await updateStats();
                console.log('‚úÖ Videolar ba≈üarƒ±yla y√ºklendi');
                
            } catch (error) {
                console.error('‚ùå Video y√ºkleme hatasƒ±:', error);
                const videosContainer = document.getElementById('videos-container');
                if (videosContainer) {
                    videosContainer.innerHTML = '<p class="text-red-500 text-center py-8">Videolar y√ºklenirken hata olu≈ütu.</p>';
                }
            }
        }

        async function loadModules() {
            try {
                console.log('üìö Mod√ºller y√ºkleniyor...');
                
                // First check if Firebase is ready
                if (!window.DB || !window.DB.isFirebaseReady) {
                    console.error('‚ùå Firebase hazƒ±r deƒüil, mod√ºller y√ºklenemiyor');
                    return;
                }
                
                // Try multiple methods to load modules
                let modules = [];
                let modulesResult = null;
                
                // Method 1: Try loadModules function
                try {
                    modulesResult = await window.DB.loadModules();
                    if (modulesResult && modulesResult.success && modulesResult.data) {
                        modules = modulesResult.data;
                        console.log('‚úÖ loadModules() ile mod√ºller y√ºklendi:', modules.length);
                    }
                } catch (err) {
                    console.warn('‚ö†Ô∏è loadModules() ba≈üarƒ±sƒ±z:', err);
                }
                
                // Method 2: Try direct load from modules collection
                if (modules.length === 0) {
                    try {
                        modulesResult = await window.DB.load('modules');
                        if (modulesResult && modulesResult.success && modulesResult.data) {
                            modules = modulesResult.data;
                            console.log('‚úÖ load("modules") ile mod√ºller y√ºklendi:', modules.length);
                        }
                    } catch (err) {
                        console.warn('‚ö†Ô∏è load("modules") ba≈üarƒ±sƒ±z:', err);
                    }
                }
                
                // Update video form module select
                const moduleSelect = document.getElementById('videoModule');
                // Update filter module select
                const filterModuleSelect = document.getElementById('filterModule');
                
                if (moduleSelect) {
                    moduleSelect.innerHTML = '<option value="">Mod√ºl Se√ßin</option>';
                    
                    if (modules && modules.length > 0) {
                        modules.forEach(module => {
                            const option = document.createElement('option');
                            option.value = module.id;
                            option.textContent = module.title || module.name || 'Mod√ºl ' + module.id;
                            moduleSelect.appendChild(option);
                        });
                        console.log('‚úÖ Video form mod√ºlleri ba≈üarƒ±yla y√ºklendi:', modules.length);
                    } else {
                        console.log('‚ö†Ô∏è Hi√ß mod√ºl bulunamadƒ±, √∂rnek mod√ºller olu≈üturuluyor...');
                        // Create sample modules if none exist
                        await createSampleModules();
                        
                        // Try loading again after creation
                        try {
                            modulesResult = await window.DB.load('modules');
                            if (modulesResult && modulesResult.success && modulesResult.data) {
                                modules = modulesResult.data;
                                console.log('‚úÖ √ñrnek mod√ºller olu≈üturulduktan sonra y√ºklendi:', modules.length);
                            }
                        } catch (err) {
                            console.error('‚ùå √ñrnek mod√ºller olu≈üturulduktan sonra da y√ºklenemedi:', err);
                        }
                        
                        if (modules.length === 0) {
                            console.error('‚ùå Mod√ºller hala bo≈ü!');
                            moduleSelect.innerHTML = '<option value="">Mod√ºl bulunamadƒ±</option>';
                            return;
                        }
                    }
                } else {
                    console.error('‚ùå Video form mod√ºl se√ßimi i√ßin element bulunamadƒ±!');
                }

                // Update filter module select
                if (filterModuleSelect) {
                    filterModuleSelect.innerHTML = '<option value="">T√ºm Mod√ºller</option>';
                    
                    if (modules && modules.length > 0) {
                        modules.forEach(module => {
                            const option = document.createElement('option');
                            option.value = module.id;
                            option.textContent = module.title || module.name || 'Mod√ºl ' + module.id;
                            filterModuleSelect.appendChild(option);
                        });
                        console.log('‚úÖ Filter mod√ºlleri ba≈üarƒ±yla y√ºklendi:', modules.length);
                    }
                } else {
                    console.error('‚ùå Filter mod√ºl se√ßimi i√ßin element bulunamadƒ±!');
                }
            } catch (error) {
                console.error('‚ùå Mod√ºl y√ºkleme hatasƒ±:', error);
                // Fallback: create sample modules
                try {
                    await createSampleModules();
                    await loadModules();
                } catch (fallbackError) {
                    console.error('‚ùå Fallback mod√ºl olu≈üturma da ba≈üarƒ±sƒ±z:', fallbackError);
                }
            }
        }

        async function createSampleModules() {
            try {
                console.log('üîß √ñrnek mod√ºller olu≈üturuluyor...');
                const sampleModules = [
                    {
                        title: 'Bilgi G√ºvenliƒüi Temelleri',
                        description: 'Bilgi g√ºvenliƒüinin temel prensipleri ve kavramlarƒ±',
                        category: 'Temel',
                        difficulty: 'beginner',
                        order: 1
                    },
                    {
                        title: 'Kriptoloji ve ≈ûifreleme',
                        description: 'Kriptografi, hash fonksiyonlarƒ± ve dijital imzalar',
                        category: 'G√ºvenlik',
                        difficulty: 'intermediate',
                        order: 2
                    },
                    {
                        title: 'Aƒü G√ºvenliƒüi',
                        description: 'Aƒü protokolleri, firewall ve VPN teknolojileri',
                        category: 'Aƒü',
                        difficulty: 'intermediate',
                        order: 3
                    },
                    {
                        title: 'Web G√ºvenliƒüi',
                        description: 'OWASP Top 10, XSS, SQL Injection ve g√ºvenli kodlama',
                        category: 'Web',
                        difficulty: 'advanced',
                        order: 4
                    },
                    {
                        title: 'Malware Analizi',
                        description: 'Zararlƒ± yazƒ±lƒ±m t√ºrleri, analiz teknikleri ve korunma',
                        category: 'Analiz',
                        difficulty: 'advanced',
                        order: 5
                    }
                ];

                for (let i = 0; i < sampleModules.length; i++) {
                    const module = sampleModules[i];
                    const moduleId = (i + 1).toString();
                    module.id = moduleId;
                    module.status = 'active';
                    module.createdAt = new Date().toISOString();
                    module.updatedAt = new Date().toISOString();
                    
                    const result = await window.DB.save('modules', module, moduleId);
                    console.log(`üìö Mod√ºl ${moduleId} kaydedildi:`, result.success ? 'Ba≈üarƒ±lƒ±' : 'Ba≈üarƒ±sƒ±z');
                }
                console.log('‚úÖ √ñrnek mod√ºller olu≈üturuldu');
            } catch (error) {
                console.error('‚ùå √ñrnek mod√ºl olu≈üturma hatasƒ±:', error);
            }
        }

        // Generate AI questions - for new video form
        async function generateAIQuestions(containerType) {
            try {
                let videoTitle = document.getElementById('videoTitle').value;
                let videoDescription = document.getElementById('videoDescription').value;
                let moduleId = document.getElementById('videoModule').value;
                
                if (!videoTitle && !videoDescription && !moduleId) {
                    alert('‚ùå Soru √ºretmek i√ßin en azƒ±ndan video ba≈ülƒ±ƒüƒ±, a√ßƒ±klama veya mod√ºl bilgisi gerekli!');
                    return;
                }
                
                // Determine question topic
                let questionTopic = videoDescription || videoTitle || 'Siber g√ºvenlik konularƒ±';
                
                if (moduleId) {
                    // Get module name from the select element
                    const moduleSelect = document.getElementById('videoModule');
                    if (moduleSelect) {
                        const selectedOption = moduleSelect.options[moduleSelect.selectedIndex];
                        if (selectedOption && selectedOption.text !== 'Mod√ºl Se√ßin') {
                            questionTopic = selectedOption.text;
                        }
                    }
                }
                
                console.log('üéØ Soru konusu:', questionTopic);
                
                // Show loading
                const button = document.getElementById('generateAIQuestions');
                if (!button) {
                    console.error('‚ùå AI buton bulunamadƒ±');
                    return;
                }
                
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Sorular Olu≈üturuluyor...';
                button.disabled = true;
                
                // Generate questions using enhanced fallback
                const questions = generateCyberSecurityQuestions(questionTopic, moduleId);
                
                // Add type and timestamp to AI questions
                const aiQuestions = questions.map(q => ({
                    ...q,
                    type: 'ai',
                    generated_at: new Date().toISOString(),
                    topic: questionTopic
                }));
                
                // Add to current video questions for later use
                if (!currentVideoQuestions) {
                    currentVideoQuestions = [];
                }
                
                currentVideoQuestions.push(...aiQuestions);
                
                // Show success message
                if (aiQuestions.length > 0) {
                    alert(`‚úÖ ${aiQuestions.length} AI soru ba≈üarƒ±yla olu≈üturuldu!\n\nKonu: ${questionTopic}\n\nToplam hazƒ±r soru sayƒ±sƒ±: ${currentVideoQuestions.length}\n\nüí° Bu sorular video kaydedildiƒüinde otomatik olarak eklenecek.\n\nSorular:\n${aiQuestions.map((q, i) => `${i + 1}. ${q.question.substring(0, 60)}...`).join('\n')}`);
                } else {
                    alert('‚ùå Sorular olu≈üturulamadƒ±.');
                }
                
                // Restore button
                button.innerHTML = originalText;
                button.disabled = false;
                
                console.log('‚úÖ AI sorular eklendi:', aiQuestions);
                
            } catch (error) {
                console.error('‚ùå Soru olu≈üturma hatasƒ±:', error);
                alert('‚ùå Sorular olu≈üturulurken hata olu≈ütu: ' + error.message);
                
                // Restore button
                const button = document.getElementById('generateAIQuestions');
                if (button) {
                    button.innerHTML = '<i class="fas fa-robot mr-2"></i>AI ile Soru Olu≈ütur';
                    button.disabled = false;
                }
            }
        }
        
        // Generate cyber security questions based on module
        function generateCyberSecurityQuestions(topic, moduleId) {
            // Get module name from the select element to determine topic
            const moduleSelect = document.getElementById('videoModule');
            let moduleName = 'Siber G√ºvenlik';
            
            if (moduleSelect && moduleSelect.value) {
                const selectedOption = moduleSelect.options[moduleSelect.selectedIndex];
                if (selectedOption && selectedOption.text !== 'Mod√ºl Se√ßin') {
                    moduleName = selectedOption.text;
                }
            }
            
            // Generate questions based on module name/topic
            const questions = [];
            
            if (moduleName.includes('Bilgi G√ºvenliƒüi') || moduleName.includes('Temelleri')) {
                questions.push(
                    {
                        question: "CIA √º√ßl√ºs√ºnde 'C' harfi neyi temsil eder?",
                        options: ['Confidentiality (Gizlilik)', 'Consistency (Tutarlƒ±lƒ±k)', 'Compliance (Uyumluluk)', 'Control (Kontrol)'],
                        correct: 0,
                        explanation: 'CIA √º√ßl√ºs√º Confidentiality, Integrity ve Availability\'den olu≈üur.'
                    },
                    {
                        question: "Bilgi g√ºvenliƒüi politikalarƒ±nƒ±n temel amacƒ± nedir?",
                        options: ['Maliyeti d√º≈ü√ºrmek', 'Verimliliƒüi artƒ±rmak', 'Bilgi varlƒ±klarƒ±nƒ± korumak', 'Teknoloji kullanƒ±mƒ±nƒ± artƒ±rmak'],
                        correct: 2,
                        explanation: 'Bilgi g√ºvenliƒüi politikalarƒ± organizasyonun bilgi varlƒ±klarƒ±nƒ± korumayƒ± ama√ßlar.'
                    },
                    {
                        question: "Risk deƒüerlendirmesinde hangi form√ºl kullanƒ±lƒ±r?",
                        options: ['Risk = Tehdit + Zafiyet', 'Risk = Tehdit √ó Zafiyet √ó Etki', 'Risk = Zafiyet - Tehdit', 'Risk = Etki √∑ Zafiyet'],
                        correct: 1,
                        explanation: 'Risk, tehdit, zafiyet ve etkinin √ßarpƒ±mƒ± ile hesaplanƒ±r.'
                    }
                );
            } else if (moduleName.includes('Kriptoloji') || moduleName.includes('≈ûifreleme')) {
                questions.push(
                    {
                        question: "AES ≈üifreleme algoritmasƒ± hangi t√ºr ≈üifrelemedir?",
                        options: ['Asimetrik', 'Simetrik', 'Hash', 'Hibrit'],
                        correct: 1,
                        explanation: 'AES (Advanced Encryption Standard) simetrik bir ≈üifreleme algoritmasƒ±dƒ±r.'
                    },
                    {
                        question: "RSA algoritmasƒ±nƒ±n temel prensibi nedir?",
                        options: ['Simetrik anahtar', 'Asal sayƒ± √ßarpanlarƒ±na ayƒ±rma', 'Hash fonksiyonu', 'Blok ≈üifreleme'],
                        correct: 1,
                        explanation: 'RSA, b√ºy√ºk asal sayƒ±larƒ±n √ßarpanlarƒ±na ayƒ±rma zorluƒüuna dayanƒ±r.'
                    },
                    {
                        question: "Dijital imza hangi ama√ßla kullanƒ±lƒ±r?",
                        options: ['≈ûifreleme', 'Kimlik doƒürulama ve b√ºt√ºnl√ºk', 'Sƒ±kƒ±≈ütƒ±rma', 'Hƒ±z artƒ±rma'],
                        correct: 1,
                        explanation: 'Dijital imza, kimlik doƒürulama ve veri b√ºt√ºnl√ºƒü√º saƒülamak i√ßin kullanƒ±lƒ±r.'
                    }
                );
            } else if (moduleName.includes('Aƒü G√ºvenliƒüi')) {
                questions.push(
                    {
                        question: "Firewall'un temel i≈ülevi nedir?",
                        options: ['Vir√ºs tarama', 'Aƒü trafiƒüini filtreleme', 'Veri yedekleme', 'Performans artƒ±rma'],
                        correct: 1,
                        explanation: 'Firewall, aƒü trafiƒüini g√ºvenlik kurallarƒ±na g√∂re filtreler.'
                    },
                    {
                        question: "IDS ve IPS arasƒ±ndaki temel fark nedir?",
                        options: ['IDS sadece izler, IPS m√ºdahale eder', 'IPS sadece izler, IDS m√ºdahale eder', 'Aynƒ± i≈ülevi g√∂r√ºrler', 'Farklƒ± protokoller kullanƒ±rlar'],
                        correct: 0,
                        explanation: 'IDS (Intrusion Detection System) sadece izler, IPS (Intrusion Prevention System) aktif m√ºdahale eder.'
                    },
                    {
                        question: "DDoS saldƒ±rƒ±sƒ±nƒ±n temel amacƒ± nedir?",
                        options: ['Veri √ßalmak', 'Sistemi kullanƒ±lamaz hale getirmek', '≈ûifre kƒ±rmak', 'Aƒüa sƒ±zmak'],
                        correct: 1,
                        explanation: 'DDoS saldƒ±rƒ±larƒ± sistemleri a≈üƒ±rƒ± y√ºkleyerek kullanƒ±lamaz hale getirmeyi ama√ßlar.'
                    }
                );
            } else if (moduleName.includes('Web G√ºvenliƒüi')) {
                questions.push(
                    {
                        question: "SQL Injection saldƒ±rƒ±sƒ± hangi katmanda ger√ßekle≈üir?",
                        options: ['Sunum katmanƒ±', 'Uygulama katmanƒ±', 'Veri katmanƒ±', 'Aƒü katmanƒ±'],
                        correct: 2,
                        explanation: 'SQL Injection saldƒ±rƒ±larƒ± veri katmanƒ±nda veritabanƒ±na y√∂nelik ger√ßekle≈üir.'
                    },
                    {
                        question: "XSS saldƒ±rƒ±sƒ±nƒ±n √∂nlenmesi i√ßin hangi y√∂ntem kullanƒ±lƒ±r?",
                        options: ['Input validation', 'Output encoding', 'Her ikisi', 'Hi√ßbiri'],
                        correct: 2,
                        explanation: 'XSS saldƒ±rƒ±larƒ±nƒ± √∂nlemek i√ßin hem input validation hem de output encoding gereklidir.'
                    },
                    {
                        question: "HTTPS protokol√º hangi g√ºvenlik √∂zelliƒüini saƒülar?",
                        options: ['Sadece ≈üifreleme', 'Sadece kimlik doƒürulama', '≈ûifreleme ve kimlik doƒürulama', 'Sadece b√ºt√ºnl√ºk'],
                        correct: 2,
                        explanation: 'HTTPS hem ≈üifreleme hem de kimlik doƒürulama saƒülar.'
                    }
                );
            } else {
                // General cyber security questions for any module
                questions.push(
                                    {
                    question: `${moduleName} alanƒ±nda en kritik g√ºvenlik √∂nlemi nedir?`,
                    options: ['G√º√ßl√º ≈üifreler', 'D√ºzenli g√ºncellemeler', 'Kullanƒ±cƒ± eƒüitimi', 'T√ºm√º gerekli'],
                    correct: 3,
                    explanation: 'Etkili g√ºvenlik i√ßin t√ºm √∂nlemler birlikte uygulanmalƒ±dƒ±r.'
                },
                {
                    question: `${moduleName} konusunda g√ºncel kalmanƒ±n en iyi yolu nedir?`,
                    options: ['Sadece kitap okumak', 'Konferanslar ve eƒüitimler', 'ƒ∞nternet ara≈ütƒ±rmasƒ±', 'Deneyim kazanmak'],
                    correct: 1,
                    explanation: 'Konferanslar ve s√ºrekli eƒüitim g√ºncel kalmak i√ßin en etkili y√∂ntemdir.'
                }
            );
            
            // Return questions (max 3)
            return questions.slice(0, 3);
        }

        // Add questions to existing video - simplified
        async function addQuestionsToVideo(videoId, videoTitle) {
            console.log('üé¨ Soru ekleme ba≈üladƒ±');
            console.log(`üÜî Video ID: ${videoId}`);
            console.log(`üì∫ Video: ${videoTitle}`);
            
            // Set current video for questions
            currentVideoId = videoId;
            console.log(`‚úÖ currentVideoId ayarlandƒ±: ${currentVideoId}`);
            
            // Show manual question section
            const manualQuestionsSection = document.getElementById('manual-questions-section');
            if (manualQuestionsSection) {
                manualQuestionsSection.style.display = 'block';
            }
            // Add first question if none exists
            if (document.getElementById('manual-questions-container').children.length === 0) {
                addNewManualQuestion();
            }
        }

        // Functions moved to top of script for better hoisting

        // Edit video function - fixed
        async function editVideo(videoId) {
            try {
                const video = await window.DB.load('coordinatorVideos', videoId);
                if (!video) {
                    alert('Video bulunamadƒ±!');
                    return;
                }
                
                // Fill form with existing data
                document.getElementById('videoTitle').value = video.title;
                document.getElementById('videoModule').value = video.moduleId;
                document.getElementById('youtubeUrl').value = video.youtubeUrl;
                document.getElementById('videoDescription').value = video.description || '';
                document.getElementById('videoDuration').value = video.duration;
                
                const difficultySelect = document.getElementById('difficulty-level');
                if (difficultySelect) {
                    difficultySelect.value = video.difficulty || 'intermediate';
                }
                
                // Set editing mode
                editingVideoId = videoId;
                
                // Update form button
                const submitButton = document.querySelector('#videoForm button[type="submit"]');
                if (submitButton) {
                    submitButton.innerHTML = '<i class="fas fa-save mr-2"></i>Deƒüi≈üiklikleri Kaydet';
                    submitButton.className = 'bg-secondary text-white px-6 py-3 rounded-lg hover:bg-secondary/90';
                }
                
                alert(`"${video.title}" videosu d√ºzenleme moduna alƒ±ndƒ±.`);
                
            } catch (error) {
                console.error('‚ùå Video d√ºzenleme hatasƒ±:', error);
                alert('‚ùå Video d√ºzenleme moduna ge√ßerken hata olu≈ütu: ' + error.message);
            }
        }

        // Delete video function moved to top of script

        // Filter videos by module
        async function filterVideos() {
            try {
                const selectedModule = document.getElementById('filterModule').value;
                const videosResult = await window.DB.load('coordinatorVideos');
                const videos = (videosResult && videosResult.success) ? videosResult.data : [];
                
                let filteredVideos = videos;
                if (selectedModule && selectedModule !== 'all') {
                    filteredVideos = videos.filter(video => video.moduleId === selectedModule);
                }
                
                const videosList = document.getElementById('videos-container');
                
                if (filteredVideos.length === 0) {
                    videosList.innerHTML = '<p class="text-gray-500 text-center py-8">Bu mod√ºlde video bulunamadƒ±.</p>';
                    return;
                }
                
                videosList.innerHTML = filteredVideos.map(video => `
                    <div class="border border-gray-200 rounded-lg p-4">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-2">
                                    <h4 class="font-medium text-gray-900">${video.title}</h4>
                                    <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">Mod√ºl ${video.moduleId}</span>
                                    <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">${video.questions ? video.questions.length : 0} Soru</span>
                                    <span class="px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full">üî• Firebase</span>
                                </div>
                                <p class="text-sm text-gray-600 mb-2">${video.description || 'A√ßƒ±klama yok'}</p>
                                <div class="flex items-center space-x-4 text-xs text-gray-500">
                                    <span><i class="fas fa-clock mr-1"></i>${video.duration} dk</span>
                                    <span><i class="fas fa-signal mr-1"></i>${video.difficulty}</span>
                                    <span><i class="fas fa-calendar mr-1"></i>${video.createdAt ? new Date(video.createdAt).toLocaleDateString('tr-TR') : 'Tarih yok'}</span>
                                </div>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <a href="${video.youtubeUrl}" target="_blank" class="bg-red-600 text-white px-3 py-1 rounded text-xs hover:bg-red-700">
                                    <i class="fab fa-youtube mr-1"></i>YouTube
                                </a>
                                <button onclick="addManualQuestionsToVideo('${video.id}', '${video.title.replace(/'/g, '\\\'')}')" class="bg-primary text-white px-3 py-1 rounded text-xs hover:bg-primary/90">
                                    <i class="fas fa-plus mr-1"></i>Manuel Soru
                                </button>
                                <button onclick="editVideo('${video.id}')" class="bg-secondary text-white px-3 py-1 rounded text-xs hover:bg-secondary/90">
                                    <i class="fas fa-edit mr-1"></i>D√ºzenle
                                </button>
                                <button onclick="deleteVideo('${video.id}')" class="bg-red-600 text-white px-3 py-1 rounded text-xs hover:bg-red-700">
                                    <i class="fas fa-trash mr-1"></i>Sil
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('‚ùå Video filtreleme hatasƒ±:', error);
            }
        }

        // Cancel questions function - simplified
        function cancelQuestions() {
            // Reset state
            currentVideoId = null;
            questionCount = 0;
            
            console.log('‚úÖ Soru ekleme iptal edildi');
        }

        // Show video form function - simplified
        function showVideoForm() {
            // Reset editing state
            editingVideoId = null;
            currentVideoId = null;
            
            // Reset form
            document.getElementById('videoForm').reset();
            
            // Reset form button
            const submitButton = document.querySelector('#videoForm button[type="submit"]');
            if (submitButton) {
                submitButton.innerHTML = '<i class="fas fa-upload mr-2"></i>Video Y√ºkle';
                submitButton.className = 'bg-cyber text-white px-6 py-3 rounded-lg hover:bg-cyber/90';
            }
        }

        // Utility functions are defined above - removing duplicates

        // Logout function
        function logout() {
            if (confirm('√áƒ±kƒ±≈ü yapmak istediƒüinizden emin misiniz?')) {
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('userEmail');
                localStorage.removeItem('loginTime');
                localStorage.removeItem('userRole');
                window.location.href = 'index.html';
            }
        }

        // Manual sync function
        async function manualSyncVideos() {
            try {
                await window.DB.syncCoordinatorVideos();
                alert('Videolar ba≈üarƒ±yla senkronize edildi!');
                await loadVideos(); // Reload to show updated count
                await updateStats();
            } catch (error) {
                console.error('‚ùå Video senkronizasyonu hatasƒ±:', error);
                alert('Videolar senkronize edilirken hata olu≈ütu: ' + error.message);
            }
        }

        // Test video creation function
        async function createTestVideo() {
            try {
                const title = 'Test Video ' + Math.floor(Math.random() * 100);
                const moduleId = '1'; // Example module
                const youtubeUrl = 'https://www.youtube.com/watch?v=dQw4w9WgXcQ'; // Example YouTube URL
                const description = 'Bu bir test videosudur. Koordinat√∂r tarafƒ±ndan eklendi.';
                const duration = '5';
                const difficulty = 'beginner';
 
                const videoId = extractYouTubeVideoId(youtubeUrl);
                if (!videoId) {
                    alert('Ge√ßerli bir YouTube URL\'si girin.');
                    return;
                }
 
                const videoData = {
                    title: title,
                    moduleId: moduleId,
                    youtubeUrl: youtubeUrl,
                    youtubeVideoId: videoId,
                    description: description,
                    duration: duration,
                    difficulty: difficulty,
                    questions: [
                        {
                            question: "Bu test videosu hangi ama√ßla olu≈üturuldu?",
                            options: ["Test i√ßin", "Eƒülence i√ßin", "Sƒ±kƒ±ntƒ±dan", "Bilinmiyor"],
                            correct: 0,
                            explanation: "Bu video senkronizasyon testleri i√ßin olu≈üturulmu≈ütur."
                        }
                    ]
                };
 
                console.log('üìπ Test video olu≈üturuluyor:', videoData);
 
                const success = await window.DB.save('coordinatorVideos', videoData);
                if (success && success.success) {
                    console.log('‚úÖ Test video eklendi:', success.id);
                    
                    // Immediately sync
                    const syncResult = await window.DB.syncCoordinatorVideos();
                    console.log('üîÑ Senkronizasyon sonucu:', syncResult);
                    
                    alert(`‚úÖ Test video ba≈üarƒ±yla eklendi ve senkronize edildi!\nVideo ID: ${success.id}\nMod√ºl: ${moduleId}`);
                    await loadVideos(); // Reload to show the new video
                    await updateStats();
                } else {
                    throw new Error('Test video ekleme ba≈üarƒ±sƒ±z');
                }
            } catch (error) {
                console.error('‚ùå Test video olu≈üturma hatasƒ±:', error);
                alert('‚ùå Test video olu≈üturulurken hata olu≈ütu: ' + error.message);
            }
        }

        // Debug function to check Firebase data
        async function debugFirebaseData() {
            try {
                const videosResult = await window.DB.load('coordinatorVideos');
                const modulesResult = await window.DB.loadModules();
                const statsResult = await window.DB.getStats();

                console.log('üìö Firebase Coordinator Videos:');
                console.log(videosResult);
                console.log('üìö Firebase Modules:');
                console.log(modulesResult);
                console.log('üìä Firebase Stats:');
                console.log(statsResult);

                alert('Firebase verileri konsola yazdƒ±rƒ±ldƒ±.');
            } catch (error) {
                console.error('‚ùå Firebase veri yazdƒ±rma hatasƒ±:', error);
                alert('Firebase veri yazdƒ±rƒ±lƒ±rken hata olu≈ütu: ' + error.message);
            }
        }

        // Generate AI questions for specific video
        async function generateAIQuestionsForVideo(videoId, videoTitle) {
            try {
                console.log('ü§ñ AI sorular √ºretiliyor video i√ßin:', videoId, videoTitle);
                
                // Load video data
                const videoResult = await window.DB.load('coordinatorVideos', videoId);
                const video = (videoResult && videoResult.success) ? videoResult.data : null;
                
                if (!video) {
                    alert('‚ùå Video bulunamadƒ±!');
                    return;
                }
                
                // Set current video
                currentVideoId = videoId;
                
                // Determine question topic
                let questionTopic = video.description || video.title || 'Siber g√ºvenlik konularƒ±';
                
                if (video.moduleId) {
                    const moduleNames = {
                        '1': 'Bilgi G√ºvenliƒüi Temelleri',
                        '2': 'Kriptoloji ve ≈ûifreleme',
                        '3': 'Aƒü G√ºvenliƒüi',
                        '4': 'Web G√ºvenliƒüi',
                        '5': 'Malware Analizi',
                        '6': 'Penetrasyon Testleri',
                        '7': 'Incident Response',
                        '8': 'Compliance ve Standartlar'
                    };
                    questionTopic = moduleNames[video.moduleId] || questionTopic;
                }
                
                console.log('üéØ Soru konusu:', questionTopic);
                
                // Generate questions using enhanced fallback
                const questions = generateCyberSecurityQuestions(questionTopic, video.moduleId);
                
                // Add type and timestamp to AI questions
                const aiQuestions = questions.map(q => ({
                    ...q,
                    type: 'ai',
                    generated_at: new Date().toISOString(),
                    topic: questionTopic
                }));
                
                if (aiQuestions.length === 0) {
                    alert('‚ùå AI sorular √ºretilemedi.');
                    return;
                }
                
                // Add questions to video
                if (!video.questions) {
                    video.questions = [];
                }
                
                const oldQuestionCount = video.questions.length;
                video.questions.push(...aiQuestions);
                video.updatedAt = new Date().toISOString();
                
                // Save updated video
                const success = await window.DB.save('coordinatorVideos', video, videoId);
                
                if (success && success.success) {
                    console.log('‚úÖ AI sorular eklendi:', aiQuestions.length);
                    
                    // Sync to student dashboard
                    await window.DB.syncCoordinatorVideos();
                    
                    alert(`‚úÖ ${aiQuestions.length} AI soru "${videoTitle}" videosuna ba≈üarƒ±yla eklendi!\n\nKonu: ${questionTopic}\n\n√ñnceki soru sayƒ±sƒ±: ${oldQuestionCount}\nYeni soru sayƒ±sƒ±: ${video.questions.length}\n\nSorular:\n${aiQuestions.map((q, i) => `${i + 1}. ${q.question.substring(0, 60)}...`).join('\n')}`);
                    
                    // Reload videos to show updated count
                    await loadVideos();
                } else {
                    throw new Error('AI sorular kaydedilemedi');
                }
                
                currentVideoId = null;
                
            } catch (error) {
                console.error('‚ùå AI soru √ºretim hatasƒ±:', error);
                alert('‚ùå AI sorular √ºretilirken hata olu≈ütu: ' + error.message);
            }
        }

        // Add manual questions to specific video
        function addManualQuestionsToVideo(videoId, videoTitle) {
            console.log('üìù Manuel soru ekleme ba≈üladƒ± video i√ßin:', videoId, videoTitle);
            
            // Set current video for questions
            currentVideoId = videoId;
            console.log(`‚úÖ currentVideoId ayarlandƒ±: ${currentVideoId}`);
            
            // Clear existing questions first
            const container = document.getElementById('manual-questions-container');
            if (container) {
                container.innerHTML = '';
                console.log('üßπ Eski sorular temizlendi');
            }
            
            // Show manual question section
            const manualQuestionsSection = document.getElementById('manual-questions-section');
            if (manualQuestionsSection) {
                manualQuestionsSection.style.display = 'block';
                
                // Update section title to show video name
                const sectionTitle = manualQuestionsSection.querySelector('h2');
                if (sectionTitle) {
                    sectionTitle.innerHTML = `
                        <i class="fas fa-edit text-primary mr-2"></i>
                        "${videoTitle}" i√ßin Manuel Soru Olu≈üturma
                    `;
                }
            }
            
            // Add first question
            addNewManualQuestion();
            console.log('‚ûï ƒ∞lk soru formu eklendi');
            
            // Scroll to the section
            if (manualQuestionsSection) {
                manualQuestionsSection.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Skip questions - hide the question section and reset
        function skipQuestions() {
            const questionSection = document.getElementById('question-addition-section');
            if (questionSection) {
                questionSection.style.display = 'none';
            }
            
            // Reset current video and questions
            currentVideoId = null;
            currentVideoQuestions = [];
            
            // Reset form
            resetVideoForm();
            
            alert('‚úÖ Video ba≈üarƒ±yla eklendi! ƒ∞stediƒüiniz zaman video listesinden soru ekleyebilirsiniz.');
            
            console.log('‚è≠Ô∏è Soru ekleme atlandƒ±');
        }
        
        // ULTRA STRONG SIDEBAR VISIBILITY SYSTEM
        function ensureSidebarVisibility() {
            const sidebar = document.querySelector('aside');
            if (sidebar) {
                // Force sidebar to stay visible with ULTRA STRONG rules
                sidebar.style.position = 'fixed';
                sidebar.style.zIndex = '999999';
                sidebar.style.left = '0';
                sidebar.style.top = '0';
                sidebar.style.height = '100vh';
                sidebar.style.overflowY = 'auto';
                sidebar.style.transform = 'none';
                sidebar.style.willChange = 'auto';
                sidebar.style.pointerEvents = 'auto';
                sidebar.style.display = 'block';
                sidebar.style.visibility = 'visible';
                sidebar.style.opacity = '1';
                
                // Add CSS class for additional safety
                sidebar.classList.add('sidebar-container');
                
                console.log('üîí Sidebar g√∂r√ºn√ºrl√ºƒü√º korunuyor - Z-Index:', sidebar.style.zIndex);
            }
        }
        
        // Start continuous sidebar visibility check
        function startSidebarVisibilityCheck() {
            // Check every 50ms (ultra frequent)
            setInterval(ensureSidebarVisibility, 50);
            
            // Check on all possible events
            const events = ['scroll', 'resize', 'load', 'visibilitychange', 'focus', 'blur', 'click', 'mousemove', 'keydown'];
            events.forEach(event => {
                window.addEventListener(event, ensureSidebarVisibility);
                document.addEventListener(event, ensureSidebarVisibility);
            });
            
            // Additional safety: check on DOM changes
            const observer = new MutationObserver(ensureSidebarVisibility);
            observer.observe(document.body, { 
                childList: true, 
                subtree: true, 
                attributes: true,
                attributeFilter: ['style', 'class']
            });
            
            console.log('üöÄ Ultra g√º√ßl√º sidebar g√∂r√ºn√ºrl√ºk sistemi ba≈ülatƒ±ldƒ±!');
        }
        
        // Initial setup
        document.addEventListener('DOMContentLoaded', ensureSidebarVisibility);
        window.addEventListener('load', ensureSidebarVisibility);
        
        // Start the sidebar visibility system
        startSidebarVisibilityCheck();
        }
    </script>
</body>
</html>

